<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bill Receipt</title>
    <style>
        body {

            background-color: #f7f7f7;
            display: flex;
            justify-content: center;
            align-items: center;

            margin: 0;
        }

        #receipt {
            width: 2.7in;
            padding: 10px;
            /* border: 1px solid #000; */
            background-color: #fff;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            font-family: 'Courier New', Courier, monospace;
        }

        .clinic-info {
            border-bottom: 1px solid #b8b5b5;
        }

        .clinic-info,
        .test-details,
        .total-cost,
        .footer {
            margin-bottom: 10px;
        }

        .clinic-info h2 {
            margin: 0;
            text-align: center;
            font-size: 1em;
            padding-bottom: 10px;
            color: #19bde6dc;
        }

        .clinic-info p {
            text-align: center;
            margin: 5px 0;
            font-size: 0.5em;
        }

        .clinic-photo img {
            width: 100%;
            height: 100px;
            display: block;
            margin: 10px 0;

        }

        .booking-info p,
        .patient-info p,
        .total-cost p,
        .footer p {
            margin: 5px 0;
            font-size: 0.6em;
        }

        .test-details,
        .footer {
            border-top: 1px solid #b8b5b5;
        }

        .test-details h3 {
            margin: 10px 0 5px;
            font-size: 0.8em;

            padding-bottom: 5px;
            color: #19bde6dc;
        }

        .test-item {
            display: flex;
            justify-content: space-between;
        }

        .test-item div {
            display: flex;
            flex-direction: column;
        }

        .test-item p {
            margin: 2px 0;
        }

        #total-cost {
            font-weight: bold;
            /* font-size: 0.8em; */
            text-align: right;
            float: right;
            color: #19bde6dc;
        }

        .footer {
            text-align: center;
            font-size: 0.8em;
            padding-top: 5px;
            margin-bottom: 0;
        }

        /* Previous CSS remains unchanged */


        .test-name,
        .test-cost,
        .test-slot,
        .test-home-collect {
            font-size: 0.6em;
        }

        .test-name p,
        .test-cost p,
        .test-slot p,
        .test-home-collect p {
            margin: 0;
        }

        .test-home-collect {
            margin-bottom: 5px;
        }

        #info-container {
            display: flex;
            justify-content: space-between;
        }
    </style>
</head>

<body>
    <div id="receipt-container">

    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.9.2/html2pdf.bundle.min.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const data = {
                BOOKING_ID: "12E8EDC982",
                BOOKING_DT: "20240530",
                BOOKING_TM: "153436",
                PHARMA_ID: 8,
                PHARMA_NAME: "SURAKSHA CLINIC",
                ADDRESS: "Old Big Bazaar Building, Near Railway Station",
                PIN: "743331",
                CITY: "Diamond Habour",
                DIST: "South 24 Parganas",
                STATE: "West Bengal",
                CLINIC_MOBILE: "8170087168",
                EMAIL: "",
                LATITUDE: 22.592913,
                LONGITUDE: 88.3983,
                PHOTO_URL: "http://easyhealths.com/storage/app/clinicphoto/8P.jpg",
                LOGO_URL: "http://easyhealths.com/storage/app/cliniclogo/8L.jpg",
                PATIENT_ID: "82",
                Patient_Name: "Riya",
                PATIENT_ADDRESS: "",
                MOBILE: "9588522488",
                SEX: "Female",
                AGE: "25",
                STATUS: "Upcoming",
                ADVICED_BY: "Dr Mamata",
                DETAILS: [
                    {
                        PKG_ID: "1020",
                        PKG_NAME: "Hb%",
                        TEST_COST: 100,
                        PAY_MODE: "Offline",
                        HOME_COLLECT: "TRUE",
                        TRANS_ID: null,
                        SLOT_DT: "20240530",
                        FROM: "7AM",
                        TO: "8AM"
                    },
                    {
                        PKG_ID: "100",
                        PKG_NAME: "MP (THICK & THIN)",
                        TEST_COST: 100,
                        PAY_MODE: "Offline",
                        HOME_COLLECT: "TRUE",
                        TRANS_ID: null,
                        SLOT_DT: "20240530",
                        FROM: "7AM",
                        TO: "8AM"
                    },
                    {
                        PKG_ID: "10",
                        PKG_NAME: "BICARBONATE (HCO3-)",
                        TEST_COST: 500,
                        PAY_MODE: "Offline",
                        HOME_COLLECT: "TRUE",
                        TRANS_ID: null,
                        SLOT_DT: "20240530",
                        FROM: "7AM",
                        TO: "8AM"
                    },
                    {
                        PKG_ID: "2",
                        PKG_NAME: "DC (DIFFERENTIAL COUNT)",
                        TEST_COST: 250,
                        PAY_MODE: "Offline",
                        HOME_COLLECT: "TRUE",
                        TRANS_ID: null,
                        SLOT_DT: "20240530",
                        FROM: "7AM",
                        TO: "8AM"
                    },
                    {
                        PKG_ID: "23",
                        PKG_NAME: "Thyroid Profile",
                        TEST_COST: 910,
                        PAY_MODE: "Offline",
                        HOME_COLLECT: "YES",
                        TRANS_ID: null,
                        SLOT_DT: "20240530",
                        FROM: "7AM",
                        TO: "8AM"
                    },
                    {
                        PKG_ID: "1020",
                        PKG_NAME: "Hb%",
                        TEST_COST: 100,
                        PAY_MODE: "Offline",
                        HOME_COLLECT: "TRUE",
                        TRANS_ID: null,
                        SLOT_DT: "20240530",
                        FROM: "7AM",
                        TO: "8AM"
                    },
                    {
                        PKG_ID: "100",
                        PKG_NAME: "MP (THICK & THIN)",
                        TEST_COST: 100,
                        PAY_MODE: "Offline",
                        HOME_COLLECT: "TRUE",
                        TRANS_ID: null,
                        SLOT_DT: "20240530",
                        FROM: "7AM",
                        TO: "8AM"
                    },
                    {
                        PKG_ID: "10",
                        PKG_NAME: "BICARBONATE (HCO3-)",
                        TEST_COST: 500,
                        PAY_MODE: "Offline",
                        HOME_COLLECT: "TRUE",
                        TRANS_ID: null,
                        SLOT_DT: "20240530",
                        FROM: "7AM",
                        TO: "8AM"
                    },
                    {
                        PKG_ID: "2",
                        PKG_NAME: "DC (DIFFERENTIAL COUNT)",
                        TEST_COST: 250,
                        PAY_MODE: "Offline",
                        HOME_COLLECT: "TRUE",
                        TRANS_ID: null,
                        SLOT_DT: "20240530",
                        FROM: "7AM",
                        TO: "8AM"
                    },
                    {
                        PKG_ID: "23",
                        PKG_NAME: "Thyroid Profile",
                        TEST_COST: 910,
                        PAY_MODE: "Offline",
                        HOME_COLLECT: "YES",
                        TRANS_ID: null,
                        SLOT_DT: "20240530",
                        FROM: "7AM",
                        TO: "8AM"
                    },
                    {
                        PKG_ID: "1020",
                        PKG_NAME: "Hb%",
                        TEST_COST: 100,
                        PAY_MODE: "Offline",
                        HOME_COLLECT: "TRUE",
                        TRANS_ID: null,
                        SLOT_DT: "20240530",
                        FROM: "7AM",
                        TO: "8AM"
                    },
                    {
                        PKG_ID: "100",
                        PKG_NAME: "MP (THICK & THIN)",
                        TEST_COST: 100,
                        PAY_MODE: "Offline",
                        HOME_COLLECT: "TRUE",
                        TRANS_ID: null,
                        SLOT_DT: "20240530",
                        FROM: "7AM",
                        TO: "8AM"
                    },
                    {
                        PKG_ID: "10",
                        PKG_NAME: "BICARBONATE (HCO3-)",
                        TEST_COST: 500,
                        PAY_MODE: "Offline",
                        HOME_COLLECT: "TRUE",
                        TRANS_ID: null,
                        SLOT_DT: "20240530",
                        FROM: "7AM",
                        TO: "8AM"
                    },
                    {
                        PKG_ID: "2",
                        PKG_NAME: "DC (DIFFERENTIAL COUNT)",
                        TEST_COST: 250,
                        PAY_MODE: "Offline",
                        HOME_COLLECT: "TRUE",
                        TRANS_ID: null,
                        SLOT_DT: "20240530",
                        FROM: "7AM",
                        TO: "8AM"
                    },
                    {
                        PKG_ID: "23",
                        PKG_NAME: "Thyroid Profile",
                        TEST_COST: 910,
                        PAY_MODE: "Offline",
                        HOME_COLLECT: "YES",
                        TRANS_ID: null,
                        SLOT_DT: "20240530",
                        FROM: "7AM",
                        TO: "8AM"
                    },
                    {
                        PKG_ID: "1020",
                        PKG_NAME: "Hb%",
                        TEST_COST: 100,
                        PAY_MODE: "Offline",
                        HOME_COLLECT: "TRUE",
                        TRANS_ID: null,
                        SLOT_DT: "20240530",
                        FROM: "7AM",
                        TO: "8AM"
                    },
                    {
                        PKG_ID: "100",
                        PKG_NAME: "MP (THICK & THIN)",
                        TEST_COST: 100,
                        PAY_MODE: "Offline",
                        HOME_COLLECT: "TRUE",
                        TRANS_ID: null,
                        SLOT_DT: "20240530",
                        FROM: "7AM",
                        TO: "8AM"
                    },
                    {
                        PKG_ID: "10",
                        PKG_NAME: "BICARBONATE (HCO3-)",
                        TEST_COST: 500,
                        PAY_MODE: "Offline",
                        HOME_COLLECT: "TRUE",
                        TRANS_ID: null,
                        SLOT_DT: "20240530",
                        FROM: "7AM",
                        TO: "8AM"
                    },
                    {
                        PKG_ID: "2",
                        PKG_NAME: "DC (DIFFERENTIAL COUNT)",
                        TEST_COST: 250,
                        PAY_MODE: "Offline",
                        HOME_COLLECT: "TRUE",
                        TRANS_ID: null,
                        SLOT_DT: "20240530",
                        FROM: "7AM",
                        TO: "8AM"
                    },
                    {
                        PKG_ID: "23",
                        PKG_NAME: "Thyroid Profile",
                        TEST_COST: 910,
                        PAY_MODE: "Offline",
                        HOME_COLLECT: "YES",
                        TRANS_ID: null,
                        SLOT_DT: "20240530",
                        FROM: "7AM",
                        TO: "8AM"
                    },
                    {
                        PKG_ID: "1020",
                        PKG_NAME: "Hb%",
                        TEST_COST: 100,
                        PAY_MODE: "Offline",
                        HOME_COLLECT: "TRUE",
                        TRANS_ID: null,
                        SLOT_DT: "20240530",
                        FROM: "7AM",
                        TO: "8AM"
                    },
                    {
                        PKG_ID: "100",
                        PKG_NAME: "MP (THICK & THIN)",
                        TEST_COST: 100,
                        PAY_MODE: "Offline",
                        HOME_COLLECT: "TRUE",
                        TRANS_ID: null,
                        SLOT_DT: "20240530",
                        FROM: "7AM",
                        TO: "8AM"
                    },
                    {
                        PKG_ID: "10",
                        PKG_NAME: "BICARBONATE (HCO3-)",
                        TEST_COST: 500,
                        PAY_MODE: "Offline",
                        HOME_COLLECT: "TRUE",
                        TRANS_ID: null,
                        SLOT_DT: "20240530",
                        FROM: "7AM",
                        TO: "8AM"
                    },
                    {
                        PKG_ID: "2",
                        PKG_NAME: "DC (DIFFERENTIAL COUNT)",
                        TEST_COST: 250,
                        PAY_MODE: "Offline",
                        HOME_COLLECT: "TRUE",
                        TRANS_ID: null,
                        SLOT_DT: "20240530",
                        FROM: "7AM",
                        TO: "8AM"
                    },
                    {
                        PKG_ID: "23",
                        PKG_NAME: "Thyroid Profile",
                        TEST_COST: 910,
                        PAY_MODE: "Offline",
                        HOME_COLLECT: "YES",
                        TRANS_ID: null,
                        SLOT_DT: "20240530",
                        FROM: "7AM",
                        TO: "8AM"
                    }
                ]
            };

            const receiptContainer = document.getElementById('receipt-container');

            // Create receipt structure
            const receipt = document.createElement('div');
            receipt.id = 'receipt';

            // Clinic Photo
            const clinicPhoto = document.createElement('div');
            clinicPhoto.className = 'clinic-photo';
            const img = document.createElement('img');
            img.src = data.LOGO_URL;
            img.alt = 'Clinic Photo';
            clinicPhoto.appendChild(img);
            receipt.appendChild(clinicPhoto);
            // Clinic Info
            const clinicInfo = document.createElement('div');
            clinicInfo.className = 'clinic-info';
            clinicInfo.innerHTML = `
        <h2>${data.PHARMA_NAME}</h2>
        <p>${data.ADDRESS}</p>
        <p>${data.CITY}, ${data.DIST}</p>
        <p>${data.STATE}, PIN: ${data.PIN}</p>
        <p>Contact: ${data.CLINIC_MOBILE}</p>
    `;
            receipt.appendChild(clinicInfo);


            const infoContainer = document.createElement('div');
            infoContainer.id = 'info-container'
            // Booking Info
            const bookingInfo = document.createElement('div');
            bookingInfo.className = 'booking-info';
            bookingInfo.innerHTML = `
            <p style="color:#19bde6dc;font-weight: 600;">BOOKING DETAILS</P>
        <p><span style="color:grey;">Booking ID:</span><span style="color:#19bde6dc;"> ${data.BOOKING_ID}</span></p>
        <p><span style="color:grey;">Booking Date:</span> ${data.BOOKING_DT}</p>
        <p><span style="color:grey;">Booking Time:</span> ${data.BOOKING_TM}</p>
    `;

            // Patient Info
            const patientInfo = document.createElement('div');
            patientInfo.className = 'patient-info';
            patientInfo.innerHTML = `
        <p style="color:#19bde6dc;font-weight: 600;">PATIENT DETAILS</P>
        <p><span style="color:grey;">Name:</span> ${data.Patient_Name}</p>
        <p><span style="color:grey;">Gender:</span> ${data.SEX}</p>
        <p><span style="color:grey;">Age:</span> ${data.AGE}</p>
        <p><span style="color:grey;">Mobile:</span> ${data.MOBILE}</p>
        <p><span style="color:grey;">Patient Address:</span> ${data.PATIENT_ADDRESS}</p>
    `;
            infoContainer.appendChild(patientInfo);
            infoContainer.appendChild(bookingInfo);

            receipt.appendChild(infoContainer);
            // Test Details
            const testDetails = document.createElement('div');
            testDetails.className = 'test-details';
            testDetails.innerHTML = `<h3>Test Details:</h3>`;
            const testList = document.createElement('div');
            testList.id = 'test-list';
            let i = 1;
            data.DETAILS.forEach(test => {
                const testItem = document.createElement('div');
                testItem.className = 'test-item';

                const testNameDiv = document.createElement('div');
                testNameDiv.className = 'test-name';
                const testName = document.createElement('p');
                testName.textContent = `${i}. ${test.PKG_NAME}`;
                testNameDiv.appendChild(testName);
                i++;
                const testCostDiv = document.createElement('div');
                testCostDiv.className = 'test-cost';
                const testCost = document.createElement('p');
                testCost.textContent = `Price: ₹${test.TEST_COST}`;
                testCostDiv.appendChild(testCost);

                const testSlotDiv = document.createElement('div');
                testSlotDiv.className = 'test-slot';
                const testSlot = document.createElement('p');
                testSlot.textContent = `Date: ${test.SLOT_DT}`;
                testSlotDiv.appendChild(testSlot);

                const testHomeCollectDiv = document.createElement('div');
                testHomeCollectDiv.className = 'test-home-collect';
                const testHomeCollect = document.createElement('p');
                testHomeCollect.textContent = `Time: ${test.FROM} - ${test.TO}`;
                testHomeCollectDiv.appendChild(testHomeCollect);

                testItem.appendChild(testNameDiv);
                testItem.appendChild(testCostDiv);

                testList.appendChild(testItem);
                testList.appendChild(testSlotDiv);
                testList.appendChild(testHomeCollectDiv);
            });
            testDetails.appendChild(testList);
            receipt.appendChild(testDetails);

            // Total Cost
            const totalCost = document.createElement('div');
            totalCost.className = 'total-cost';
            const totalAmount = data.DETAILS.reduce((sum, test) => sum + test.TEST_COST, 0);
            totalCost.innerHTML = `
            <p>Payment Mode: Offline</p>
        <p>Total Cost: <span id="total-cost">₹${totalAmount}</span></p>
        <p>Tax: <span id="total-cost">₹0</span></p>
        <p>Amount Payable: <span id="total-cost">₹${totalAmount}</span></p>
    `;
            receipt.appendChild(totalCost);

            // Footer
            const footer = document.createElement('div');
            footer.className = 'footer';
            footer.innerHTML = `
        <p>Thank you for choosing <span style="color:#19bde6dc;">${data.PHARMA_NAME}</span></p>
        <p>Visit Again!</p>
    `;
            receipt.appendChild(footer);


            receiptContainer.appendChild(receipt);
            // Wait for images to load before calculating height
            const images = receipt.getElementsByTagName('img');
            let imagesLoaded = 0;

            const onImageLoad = () => {
                imagesLoaded++;
                if (imagesLoaded === images.length) {
                    generatePDF();
                }
            };

            for (let i = 0; i < images.length; i++) {
                if (images[i].complete) {
                    onImageLoad();
                } else {
                    images[i].addEventListener('load', onImageLoad);
                    images[i].addEventListener('error', onImageLoad);
                }
            }

            if (images.length === 0) {
                generatePDF();
            }

            function generatePDF() {
                //     const receiptWidth = receipt.offsetWidth;
                //     const receiptHeight = receipt.offsetHeight + 30;

                //     html2pdf().from(receipt).set({
                //         margin: 0,
                //         image: { type: "jpeg", quality: 0.98 },
                //         filename: 'receipt.pdf',
                //         html2canvas: {
                //             scale: 1.5
                //         },
                //         jsPDF: {
                //             unit: 'px',
                //             format: [receiptWidth, receiptHeight]
                //         }
                //     })
                //         .toPdf()
                //         .output("datauristring")
                //         .then(function (pdfDataUri) {
                //             const pdfWindow = window.open();
                //             pdfWindow.document.write(
                //                 '<iframe width="100%" height="100%" src="' +
                //                 pdfDataUri +
                //                 '" frameborder="0"></iframe>'
                //             );
                //             pdfWindow.document.close();

                //             // Automatically focus the new window/tab

                //             pdfWindow.focus();
                //             //location.reload();
                //         });
            }
        });

    </script>
</body>

</html>