<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Dashboard</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css"
    />
    <style>
      /* Custom CSS */
      .navbar-brand {
        margin-left: 70px;
      }
      .navbar-brand img {
        max-height: 40px;
        margin-right: 10px; /* Add space to the left of the logo */
      }
      .user-profile {
        cursor: pointer;
      }
      /* .user-profile:hover .username {
        display: inline;
      } */
      .username {
        display: none;
        font-weight: bold;
      }
      .dropdown-menu {
        min-width: 250px;
      }
      .header {
        background-color: rgb(20, 20, 94);
        height: 40px;
      }
      .navbar {
        box-shadow: 0 2px 7px rgba(0, 0, 0, 0.1); /* Add shadow effect */
      }
      .search-icon {
        color: #007bff; /* Blue color */
      }
      .current-location {
        color: #007bff; /* Blue color */
        border: none;
        background: none;
      }
      .city-list li {
        cursor: pointer;
      }
      .searchfield {
        width: 80%;
        z-index: 1;
      }
      #searchInput {
        width: 80%;
        outline: none;
        border: none;
        margin-left: 20px;
        background-color: #f8f9fa;
      }

      .searchbar-container {
        position: relative;
        width: 80%; /* Search bar takes 60% of the navbar width */
        border: 2px black solid;
        border-radius: 100px;
        margin-left: 20px;
        z-index: 0;
      }
      .searchbar {
        padding: 10px 30px 10px 10px; /* Adjust padding to your preference */
        font-size: 16px;
        outline: none;
        border: none;
        box-shadow: none;
      }
      .searchbar:focus {
        outline: none; /* Border color when focused */
      }
      .input-group-text {
        padding: 0;
        border: none;
        margin-right: 20px;
      }
      /* Service Boxes */
      .service-box {
        background-color: #f2f2f2;
        color: #000000; /* Black text color */
        padding: 20px;
        margin: 30px;
        border-radius: 20px; /* Rounded corners */
        text-align: center;
        cursor: pointer;
        height: 150px; /* Set fixed height */
        width: 55%;
      }

      .service-box i {
        color: #458ece; /* Blue icon color */
        font-size: 60px; /* Increased icon size */
        margin-top: 10px; /* Added margin below the icon */
      }

      .service-box h4 {
        margin-top: 0; /* Remove default top margin */
      }

      .service-box:hover {
        background-color: #e0e0e0; /* Lighter background color on hover */
      }
      #searchResults {
        list-style-type: none;
        padding: 0;
        position: absolute;
        z-index: 1;
        width: 100%;
        background-color: #fff;
        box-shadow: 0px 5px 10px rgba(0, 0, 0, 0.1);
        overflow-y: auto; /* Add scrollbar if needed */
        max-height: 150px; /* Limit max height to show scrollbar */
        display: none; /* Hide by default */
        top: 40px;
      }

      #searchResults.active {
        display: block; /* Show when active */
      }

      #searchResults li {
        padding: 10px;
        background-color: #f9f9f9;
        border-bottom: 1px solid #ddd;
        cursor: pointer;
        display: flex;
        align-items: center;
      }

      #searchResults li:hover {
        background-color: #f3f3f3;
      }

      .doctor-info {
        margin-left: 10px;
      }

      .doctor-info h5 {
        margin: 0;
      }

      .doctor-info p {
        margin: 5px 0;
      }

      .doctor-photo {
        width: 50px;
        height: 50px;
        border-radius: 50%;
        background-color: #ddd;
        overflow: hidden;
      }

      .doctor-photo img {
        width: 100%;
        height: 100%;
        object-fit: cover;
      }

      .no-results {
        padding: 10px;
        text-align: center;
      }

      /* New lab search results list */
      #labSearchResults {
        list-style-type: none;
        padding: 0;
        position: absolute;
        z-index: 1;
        width: 100%;
        background-color: #fff;
        box-shadow: 0px 5px 10px rgba(0, 0, 0, 0.1);
        overflow-y: auto; /* Add scrollbar if needed */
        max-height: 150px; /* Limit max height to show scrollbar */
        display: none; /* Hide by default */
        top: 160px; /* Adjust top position as needed */
      }

      #labSearchResults.active {
        display: block; /* Show when active */
      }

      #labSearchResults li {
        padding: 10px;
        background-color: #f9f9f9;
        border-bottom: 1px solid #ddd;
        cursor: pointer;
        display: flex;
        align-items: center;
      }

      #labSearchResults li:hover {
        background-color: #f3f3f3;
      }
      /* voice search style */
      .voicemodal {
        display: none;
        position: fixed;
        z-index: 1;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        overflow: auto;
        background-color: rgba(0, 0, 0, 0.4);

        justify-content: center;
        align-items: center;
      }

      .voicemodal-content {
        background-color: #fefefe;
        padding: 20px;
        border-radius: 50%;
        width: 200px;
        height: 200px;
        text-align: center;
        position: relative;
      }
      .voiceicon {
        border: none;
        margin-right: 30px;
      }
      .icon-container {
        display: flex;
        justify-content: center;
        align-items: center;
        height: 100%;
      }

      .icon-container button {
        margin: 0 10px;
        padding: 10px;
        font-size: 24px;
        cursor: pointer;
        border: none;
        background: none;
        outline: none;
        color: #007bff;
      }

      .icon-container button.stop-button {
        color: red;
      }

      .recording-animation {
        animation: pulse 0.5s infinite alternate;
      }

      @keyframes pulse {
        from {
          transform: scale(1);
        }
        to {
          transform: scale(1.1);
        }
      }
    </style>
  </head>
  <body>
    <div class="header navbar"></div>
    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg navbar-light bg-light">
      <!-- Logo -->
      <a class="navbar-brand" href="dashboard.html">
        <img src="" alt="Company Logo"  id="companyLogo"/>
      </a>
      <!-- Search and Location Dropdown -->
      <div class="d-flex align-items-center searchfield">
        <!-- Location Dropdown -->
        <!-- <div class="dropdown">
          <button
            class="btn btn-outline-primary dropdown-toggle"
            type="button"
            id="location-dropdown"
            data-bs-toggle="dropdown"
            aria-expanded="false"
          >
            <span id="selected-city">Select City</span>
          </button>
          <ul class="dropdown-menu" aria-labelledby="location-dropdown">
            <li>
              <input
                type="text"
                class="form-control mb-2"
                id="city-search-input"
                placeholder="Search City"
              />
            </li>
            <li>
              <button
                class="btn btn-link current-location"
                id="current-location"
              >
                Current Location
              </button>
            </li>
            <li><hr class="dropdown-divider" /></li>
            <li class="city-list">
              <a class="dropdown-item" href="#">Mumbai</a>
            </li>
            <li class="city-list">
              <a class="dropdown-item" href="#">Delhi</a>
            </li>
            <li class="city-list">
              <a class="dropdown-item" href="#">Bangalore</a>
            </li>
            
          </ul>
        </div> -->
        <!-- Search Bar with Search Icon -->
        <div class="input-group searchbar-container">
          <input
            type="text"
            class="searchbar"
            placeholder="Search"
            aria-label="Search"
            aria-describedby="search-button"
            id="searchInput"
            autocomplete="off"
          />
          <button
            class="btn btn-outline-primary voiceicon"
            type="button"
            id="openModalButton"
          >
            <i class="fas fa-microphone"></i>
          </button>
          <div class="input-group-text">
            <i class="fas fa-search"></i>
          </div>

          <ul id="searchResults"></ul>
          <!-- New labSearchResults list -->
          <ul id="labSearchResults"></ul>
        </div>
      </div>
      <div id="myModal" class="voicemodal">
        <div class="voicemodal-content">
          <div class="icon-container">
            <button id="startButton"><i class="fas fa-microphone"></i></button>
            <button id="stopButton" class="stop-button" style="display: none">
              <i class="fas fa-stop"></i>
            </button>
          </div>
        </div>
      </div>
      <!-- User Profile Icon -->
      <div class="user-profile ms-3">
        <img src="profile-icon.png" alt="User Profile" width="40" height="40"/>
        <span class="username">Username</span>
      </div>
    </nav>

    <!-- City Search Modal -->
    <div
      class="modal fade"
      id="citySearchModal"
      tabindex="-1"
      aria-labelledby="citySearchModalLabel"
      aria-hidden="true"
    >
      <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="citySearchModalLabel">Select City</h5>
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="modal"
              aria-label="Close"
            ></button>
          </div>
          <div class="modal-body">
            <!-- medical Search Field -->
            <div class="input-group mb-3">
              <input
                type="text"
                class="form-control"
                placeholder="Search City"
                aria-label="Search City"
                id="medical-search-input"
              />
              <button
                class="btn btn-outline-secondary"
                type="button"
                id="medical-search-button"
              >
                Search
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="container mt-5">
      <div class="row">
        <div class="col-md-4">
          <div
            class="service-box"
            id="doctors-booking"
            onclick="handleDoctorsBooking()"
          >
            <i class="fas fa-user-md"></i>
            <h4>Doctors Booking</h4>
          </div>
        </div>
        <div class="col-md-4">
          <div
            class="service-box"
            id="lab-test-booking"
            onclick="handleLabTestBooking()"
          >
            <i class="fas fa-flask"></i>
            <h4>Lab Test Booking</h4>
          </div>
        </div>
        <div class="col-md-4">
          <div
            class="service-box"
            onclick="window.location.href='reportTransfer.html'"
          >
            <i class="fas fa-file-medical-alt"></i>
            <h4>Report Transfer</h4>
          </div>
        </div>
      </div>
    </div>

    <!-- Doctor List -->
    <div class="container mt-5" id="doctor-list" style="display: none">
      <!-- Doctor data will be dynamically added here -->
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/js/all.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>

    <script>
      // Initialize searchData variable as an empty array
      let searchData = [];
      let doctorData = []; // Array to store data with field_type 'doctor'
      let labTestData = []; // Array to store data with field_type other than 'doctor'
      let userData = null;
      document.addEventListener("DOMContentLoaded", function () {
        // Check if the user is already logged in
        const isLoggedIn = localStorage.getItem("isLoggedIn");
        if (isLoggedIn) {
          // Retrieve username from localStorage
          const username = localStorage.getItem("username");
          // Do something with the logged-in user's data
          const storedUserData = localStorage.getItem("userData");

          // Access and use the user's data
          if (storedUserData) {
            userData = JSON.parse(storedUserData);
            console.log(userData);
            // Set the logo URL dynamically
            const companyLogo = document.getElementById("companyLogo");
            companyLogo.src = userData.data.LOGO_URL;
          }
        }
      });
      function handleDoctorsBooking() {
        window.location.href = "doctorsBooking.html";
      }

      // Handle Lab Test Booking Click
      function handleLabTestBooking() {
        // Add your logic for lab test booking here
        window.location.href = "labtestBooking.html";
      }
      const searchInput = document.getElementById("searchInput");
      const searchResults = document.getElementById("searchResults");

      function populateSearchResults(query) {
        searchResults.innerHTML = "";

        if (query.trim() === "") {
          return;
        }

        const filteredDoctors = doctorData.filter((doctor) =>
          Object.values(doctor).some((value) =>
            value.toString().toLowerCase().includes(query.toLowerCase())
          )
        );

        if (filteredDoctors.length === 0) {
          const noResultsItem = document.createElement("li");
          noResultsItem.classList.add("no-results");
          noResultsItem.textContent = "No match found.";
          searchResults.appendChild(noResultsItem);
          return;
        }
        const filtered = filteredDoctors.sort((a, b) => {
          const cleanAItemName = a.ITEM_NAME.toLowerCase();
          const cleanBItemName = b.ITEM_NAME.toLowerCase();
          const aIndex = cleanAItemName.indexOf(query.toLowerCase());
          const bIndex = cleanBItemName.indexOf(query.toLowerCase());
          return aIndex - bIndex;
        });
        console.log(filtered);

        filtered.forEach((doctor) => {
          const listItem = document.createElement("li");

          const doctorPhotoContainer = document.createElement("div");
          doctorPhotoContainer.classList.add("doctor-photo");
          doctorPhotoContainer.innerHTML = `
          <img src="${doctor.DETAILS.DR_PHOTO}" alt="${doctor.DETAILS.DR_NAME}" class="me-3">
        `;

          const doctorInfoContainer = document.createElement("div");
          doctorInfoContainer.classList.add("doctor-info");
          doctorInfoContainer.innerHTML = `
          <h5>${doctor.ITEM_NAME}</h5>
          <p>${doctor.DETAILS.DESIGNATION}</p>
        `;

          listItem.appendChild(doctorPhotoContainer);
          listItem.appendChild(doctorInfoContainer);

          listItem.addEventListener("click", () => {
            console.log(doctor);
          });

          searchResults.appendChild(listItem);
        });

        searchResults.classList.add("active"); // Show search results
      }

      function closeSearchResults() {
        searchResults.classList.remove("active"); // Hide search results
      }
      function closeLabSearchResults() {
        labSearchResults.classList.remove("active"); // Hide search results
      }
      searchInput.addEventListener("input", () => {
        const query = searchInput.value;
        populateSearchResults(query);
        populateLabSearchResults(query);
      });

      // Close search results when clicking outside the search container
      document.addEventListener("click", (event) => {
        const isClickInsideSearchContainer =
          searchInput.contains(event.target) ||
          searchResults.contains(event.target);
        if (!isClickInsideSearchContainer) {
          closeSearchResults();
        }
        const isClickInsideLabSearchContainer =
          searchInput.contains(event.target) ||
          labSearchResults.contains(event.target);
        if (!isClickInsideLabSearchContainer) {
          closeLabSearchResults();
        }
      });

      searchInput.addEventListener("click", (event) => {
        event.stopPropagation();
        if (searchResults.innerHTML.trim() !== "") {
          searchResults.classList.add("active");
        }
        if (labSearchResults.innerHTML.trim() !== "") {
          labSearchResults.classList.add("active");
        }
      });
      // Function to make a POST request with latitude and longitude using Axios
      function sendLocation(latitude, longitude) {
        // Your API endpoint URL
        const apiUrl = "http://easyhealths.com/api/srchdrtest";

        // Data to be sent in the request body
        const postData = {
          LATITUDE: latitude,
          LONGITUDE: longitude,
        };

        // Making a POST request using Axios
        axios
          .post(apiUrl, postData)
          .then((response) => {
            // Handle response data
            //searchData = response.data && Array.isArray(response.data) ? response.data : []; // Convert object data to array, or assign an empty array
            searchData = response.data;
            console.log(searchData.data);
            console.log(typeof searchData.data);
            // Filter data based on field_type
            doctorData = searchData.data.filter(
              (item) => item.FIELD_TYPE === "Doctor"
            );
            populateDoctorList(doctorData);
            labTestData = searchData.data.filter(
              (item) => item.FIELD_TYPE !== "Doctor"
            );
            console.log(doctorData);
            console.log(labTestData);
          })
          .catch((error) => {
            // Handle errors
            console.error("There was an error:", error);
          });
      }

      // Function to populate the doctor list
      function populateDoctorList(doctors) {
        const doctorListContainer = document.getElementById("doctor-list");
        doctorListContainer.innerHTML = ""; // Clear previous list items
        doctors.forEach((doctor) => {
          const doctorItem = document.createElement("div");
          doctorItem.classList.add(
            "doctor",
            "d-flex",
            "align-items-center",
            "justify-content-between",
            "mb-3"
          );
          doctorItem.innerHTML = `
      <div class="doctor-details d-flex align-items-center">
        <img src="${doctor.DETAILS.DR_PHOTO}" alt="${doctor.DETAILS.DR_NAME}" class="me-3">
        <div class="details">
          <h5>${doctor.DETAILS.DR_NAME}</h5>
          <p>${doctor.DETAILS.D_CATG}</p>
          <p>${doctor.DETAILS.EXPERIENCE} Experience</p>
          <p>${doctor.DETAILS.QUALIFICATION}</p>
          <p>${doctor.DETAILS.SEX}</p>
        </div>
      </div>
      <div class="book-appointment">
        <button onclick="bookAppointment('${doctor.DETAILS.DR_ID}')" class="btn btn-primary">Book Appointment</button>
      </div>
    `;
          doctorListContainer.appendChild(doctorItem);
        });
      }
      // Function to get current location and call sendLocation function
      function getLocation() {
        searchInput.click();
        searchInput.focus();
        if (navigator.geolocation) {
          navigator.geolocation.getCurrentPosition(
            (position) => {
              const latitude = position.coords.latitude;
              const longitude = position.coords.longitude;
              sendLocation(latitude, longitude);
            },
            (error) => {
              console.error("Error getting the current location:", error);
            }
          );
        } else {
          console.error("Geolocation is not supported by this browser.");
        }
      }

      // Call getLocation function when the page loads
      window.onload = getLocation;

      // Event listener for clicking on "Doctors Booking" service box
      document
        .getElementById("doctors-booking")
        .addEventListener("click", function () {
          console.log(doctorData);
        });

      // Event listener for clicking on "Lab Test Booking" service box
      document
        .getElementById("lab-test-booking")
        .addEventListener("click", function () {
          console.log(labTestData);
        });

      // Function to populate lab search results
      function populateLabSearchResults(query) {
        const labSearchResults = document.getElementById("labSearchResults");
        labSearchResults.innerHTML = "";

        if (query.trim() === "") {
          return;
        }

        const filteredLabTests = labTestData
          .filter((item) => {
            const lowerCaseQuery = query.toLowerCase();
            const cleanItemName = item.ITEM_NAME.toLowerCase();

            return cleanItemName.includes(lowerCaseQuery);
          })
          .sort((a, b) => {
            const lowerCaseQuery = query.toLowerCase();
            const cleanAItemName = a.ITEM_NAME.toLowerCase();
            const cleanBItemName = b.ITEM_NAME.toLowerCase();
            const aIndex = cleanAItemName.indexOf(lowerCaseQuery);
            const bIndex = cleanBItemName.indexOf(lowerCaseQuery);
            return aIndex - bIndex;
          });
        console.log(filteredLabTests);

        if (filteredLabTests.length === 0) {
          const noResultsItem = document.createElement("li");
          noResultsItem.classList.add("no-results");
          noResultsItem.textContent = "No match found.";
          labSearchResults.appendChild(noResultsItem);
          return;
        }

        filteredLabTests.forEach((labTest) => {
          const listItem = document.createElement("li");
          // Create your list item content here similar to the searchResults list
          const doctorInfoContainer = document.createElement("div");
          doctorInfoContainer.classList.add("doctor-info");
          doctorInfoContainer.innerHTML = `
          <h5>${labTest.ITEM_NAME}</h5>`;
          listItem.appendChild(doctorInfoContainer);
          listItem.addEventListener("click", () => {
            console.log(labTest);
          });
          labTest;
          labSearchResults.appendChild(listItem);
        });

        labSearchResults.classList.add("active"); // Show search results
      }

      const openModalButton = document.getElementById("openModalButton");
      const modal = document.getElementById("myModal");
      const startButton = document.getElementById("startButton");
      const stopButton = document.getElementById("stopButton");

      let recognition;

      openModalButton.addEventListener("click", function () {
        modal.style.display = "flex";
        startRecording();
      });

      startButton.onclick = startRecording;
      stopButton.onclick = stopRecording;

      function startRecording() {
        recognition = new (window.SpeechRecognition ||
          window.webkitSpeechRecognition ||
          window.mozSpeechRecognition ||
          window.msSpeechRecognition)();
        recognition.lang = "en-US";
        recognition.start();

        startButton.style.display = "none";
        stopButton.style.display = "inline-block";

        modal.classList.add("recording-animation");

        recognition.onresult = function (event) {
          const transcript = event.results[0][0].transcript;
          searchInput.value = transcript; // Clear the input field before updating it
          searchInput.focus();
          searchInput.click();
          populateSearchResults(transcript);
          populateLabSearchResults(transcript);
        };

        recognition.onend = function () {
          modal.classList.remove("recording-animation");
          stopRecording();
          modal.style.display = "none";
        };

        setTimeout(() => {
          stopRecording();
          modal.style.display = "none";
        }, 10000); // 10 seconds maximum duration
        // Set focus on the input field
        //searchInput.focus();
      }

      function stopRecording() {
        if (recognition) {
          recognition.stop();
          recognition = null;
        }

        startButton.style.display = "inline-block";
        stopButton.style.display = "none";
      }

      // Listen for key presses
      // Listen for key presses
      // Listen for key presses
      document.addEventListener("keydown", function (event) {
        // Check if the Shift key is pressed along with another key
        if (event.shiftKey) {
          console.log("clicked");
          switch (event.key) {
            case "D": // Shift + D for Doctors Booking
              event.preventDefault(); // Prevent default action
              handleDoctorsBooking();
              break;
            case "T": // Shift + L for Lab Test Booking
              event.preventDefault(); // Prevent default action
              handleLabTestBooking();
              break;
            case "R": // Shift + T for Report Transfer
              event.preventDefault(); // Prevent default action
              window.location.href = "reportTransfer.html";
              break;
            default:
              break;
          }
        }
      });
    </script>
  </body>
</html>
