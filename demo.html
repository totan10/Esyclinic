<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Doctor's Profile - Dr. Ashutosh Samal</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
      crossorigin="anonymous"
    />
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css"
      rel="stylesheet"
    />
    <style>
      /* Add custom styles here */
      body {
        margin: 0;
        padding: 0;
        background-color: #f8f9fa;
        font-family: Arial, sans-serif;
      }
      #doctorProfileContainer {
        margin: 0;
        max-width: fit-content;
      }
      .doctor-profile {
        margin-bottom: 30px;
        display: flex;
        justify-content: flex-start;
      }
      .doctor-image {
        margin-right: 30px;
        flex-shrink: 0; /* Prevent image from shrinking */
        width: 200px; /* Adjust image width */
        height: fit-content; /* Maintain aspect ratio */
      }
      .doctor-image img {
        border: 2px solid #f8f9fa;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1); /* Add shadow effect */
        z-index: 2;
      }
      .doctor-info {
        flex: 1;
      }
      .designation {
        margin-bottom: 10px;
        font-weight: bold;
      }
      .specialization,
      .experience,
      .qualification {
        margin-bottom: 5px;
      }
      .fees,
      .id,
      .mobile,
      .language,
      .sex {
        margin-bottom: 5px;
      }
      .appointments {
        text-align: center;
      }
      .slot-container {
        max-width: 100%;
      }
      /* Add modern 3D look to rounded rectangles */
      .slot-item {
        background-color: #00b2c8;
        border-radius: 25px;
        padding: 30px; /* Increase padding */
        margin-bottom: 20px;
        cursor: pointer;
        box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
        transition: transform 0.3s ease;
        z-index: 0;
        position: relative;
      }
      .slot-item:hover {
        transform: translateY(-5px);
      }
      .slot-item h3 {
        color: white;
      }
      .date-day {
        color: white;
        text-align: center;
        font-weight: 700;
        font-size: x-large;
      }
      .status {
        text-align: center;
        font-size: x-large;
        font-weight: 700;
      }
      /* Add a new class for slot timings within the modal */
      .modal-slot-item {
        background-color: transparent;
        border: 2px solid rgb(54, 53, 53);
        border-radius: 10px;
        padding: 5px; /* Adjust padding */
        margin-right: 5px; /* Add margin between slot items */
        margin-bottom: 10px; /* Adjust margin bottom */
        cursor: pointer;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1); /* Add shadow effect */
        transition: transform 0.3s ease, background-color 0.3s ease; /* Add transition for transform and background-color */
        width: 24%;
      }
      /* Display a maximum of six slot timings per row */
      .slot-section {
        display: flex;
        flex-wrap: wrap;
        justify-content: flex-start;
        opacity: 0; /* Initially hide the slots */
        transition: opacity 0.3s ease; /* Add transition effect for opacity */
      }
      .slot-section.active {
        opacity: 1; /* Show the slots when active */
      }
      /* Style for timing text */
      .modal-slot-item span {
        color: #1b18b0; /* Blue color */
        text-align: center;
        display: block;
        margin-bottom: 5px;
        font-size: medium;
        transition: color 0.3s ease; /* Add transition for color change */
      }
      /* Style for availability text */
      .modal-slot-item .availability {
        color: rgb(3 207 3); /* Green color */
        margin: 0;
        text-align: center;
        font-size: medium;
        transition: color 0.3s ease;
      }
      .modal-slot-item:hover {
        transform: translateY(-5px);
        background-color: #00b2c8; /* Change background color on hover */
        border: none;
      }
      .modal-slot-item:hover span {
        color: white; /* Change text color on hover */
      }
      .modal-slot-item:hover .availability {
        color: greenyellow;
        font-weight: 700;
      }
      .slotTime {
        display: none;
        max-height: 0;
        transition: max-height 1s ease; /* Add transition effect for opening and closing */
        overflow: hidden; /* Hide overflowing content */
      }

      .slotTime.active {
        display: block;
        max-height: 2000px; /* Adjust the max height as per your content */
        transition: max-height 1s ease;
        position: relative;
        z-index: 3;
      }

      .booking-form {
        margin-top: 20px;
        padding: 20px;
        border: 1px solid #ccc;
        border-radius: 10px;
        background-color: #fff;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        /* height: 60%; */
      }
      .booking-form input[type="text"],
      .booking-form input[type="tel"],
      .booking-form select,
      #patientAge {
        width: 100%;
        margin-bottom: 10px;
        padding: 10px;
        border: 1px solid #ccc;
        border-radius: 5px;
        transition: border-color 0.15s ease-in-out, box-shadow 0.15s ease-in-out;
      }
      .buttonContainer {
        margin-top: 20px;
      }
      .booking-form input[type="submit"] {
        /* width: 100%; */
        padding: 10px;
        background-color: #007bff;
        color: #fff;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        transition: background-color 0.15s ease-in-out;
        margin-left: 100px;
        /* position: absolute;
        bottom: 20px;
        left: 25%; */
        width: 150px;
      }
      .booking-form input[type="submit"]:hover {
        background-color: #0056b3;
      }

      #cancelButton {
        padding: 10px;
        background-color: #ff4d4d; /* Red background */
        color: white;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        width: 20%;
        transition: background-color 0.15s ease-in-out;
        margin-left: 100px;
        /* position: absolute;
        bottom: 20px;
        right: 25%; */
      }

      #cancelButton:hover {
        background-color: #cc0000; /* Darker red on hover */
      }

      /* CSS animations for form elements */
      .booking-form input[type="text"],
      .booking-form input[type="tel"],
      .booking-form select,
      #patientAge,
      #patientDropdown .booking-form input[type="submit"],
      #cancelButton {
        transition: transform 0.3s ease-in-out;
      }
      #patientDropdown {
        display: none;
      }
      .booking-form input[type="text"]:focus,
      .booking-form input[type="tel"]:focus,
      .booking-form select:focus,
      #patientAge:focus,
      #patientDropdown:focus .booking-form input[type="submit"]:focus,
      #cancelButton:focus {
        transform: scale(1.05); /* Scale up on focus */
      }

      /* Set height of the booking form to match the screen height */
      .booking-container {
        height: 100vh;
        display: none;
        justify-content: center;
        align-items: center;
      }

      /* Add animation to the booking form */
      .booking-form {
        animation: slideInFromLeft 1s ease;
      }

      @keyframes slideInFromLeft {
        0% {
          transform: translateX(-100%);
          opacity: 0;
        }
        100% {
          transform: translateX(0);
          opacity: 1;
        }
      }

      .popup-overlay {
        position: fixed;
        top: 0;
        right: 0;
        width: 50%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.5);
        display: flex;
        justify-content: center;
        align-items: center;
        z-index: 9999;
        visibility: hidden;
      }

      .popup {
        background-color: #fff;
        padding: 20px;
        border-radius: 5px;
        box-shadow: 0px 0px 10px rgba(0, 0, 0, 0.3);
        text-align: center;
      }

      .popup button:hover {
        transform: translateY(-5px);
        color: #15b9ce;
        background-color: #ffffff;
        border: 2px solid #15b9ce;
      }

      .popup button:active {
        transform: translateY(2px);
      }

      .popup button:focus {
        outline: none;
      }

      .popup button {
        position: relative;
        background-color: #15b9ce; /* Green */
        border: none;
        font-size: 20px;
        color: #ffffff;
        text-align: center;
        transition-duration: 0.4s;
        overflow: hidden;
        cursor: pointer;
        border-radius: 15px;
        margin: 10px;
        padding: 10px 20px;
        transition: transform 0.3s;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
      }

      .popup button:after {
        content: "";
        background: #90ee90; /* Light Green */
        display: block;
        position: absolute;
        padding-top: 300%;
        padding-left: 350%;
        margin-left: -20px !important;
        margin-top: -120%;
        opacity: 0;
        transition: all 0.8s;
      }

      .popup button:active:after {
        padding: 0;
        margin: 0;
        opacity: 1;
        transition: 0s;
      }
      .booking-confirmation {
        position: fixed;
        top: 0;
        right: 0;
        width: 50%;
        height: 100%;
        display: none;
      }

      /* CSS for booking confirmation */
      .booking-confirmation {
        position: fixed;
        width: 50%;

        padding: 20px;
        background-color: #fff;
        border-radius: 15px;
        box-shadow: 0 0 20px rgba(0, 0, 0, 0.2);
      }

      .confirmation-heading {
        margin-top: 0;
        margin-bottom: 20px;
        text-align: center;
        color: #72d3e4;
      }

      .info-container {
        margin-bottom: 20px;
        padding: 20px;
        border-radius: 15px;
        background-color: #f0f0f0;
        box-shadow: 0 0 20px rgba(0, 0, 0, 0.1);
        border: 2px solid #4bb0bb;
      }
      .info-container span {
        font-weight: 700;
      }
      .info-container h4 {
        font-weight: 700;
      }
      .patient-info,
      .appointment-info {
        margin-bottom: 20px;
      }

      .buttons-container {
        display: flex;
        justify-content: space-around;
      }
      .booking-button {
        background-color: #007bff;
      }
      .cancel-button {
        background-color: #cc0000;
      }
      .booking-button,
      .cancel-button {
        padding: 10px 20px;
        font-size: 16px;
        color: #fff;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        transition: all 0.3s ease;
        position: relative;
        overflow: hidden;
        z-index: 1;
      }

      .booking-button::before,
      .cancel-button::before {
        content: "";
        position: absolute;
        top: 0;
        left: 50%;
        width: 300%;
        height: 100%;
        background: rgba(255, 255, 255, 0.2);
        transition: all 0.3s ease;
        z-index: -1;
      }

      .booking-button:hover::before,
      .cancel-button:hover::before {
        left: 0;
      }

      .booking-button:hover {
        color: #007bff;
        background-color: #fff;
        border: 1px solid #007bff;
        box-shadow: 0 0 20px rgba(0, 0, 0, 0.1);
      }

      .cancel-button:hover {
        color: #ff4d4d;
        background-color: #fff;
        border: 1px solid #cc0000;
        box-shadow: 0 0 20px rgba(0, 0, 0, 0.1);
      }

      .booking-button::after,
      .cancel-button::after {
        content: "";
        position: absolute;
        top: 50%;
        left: 50%;
        width: 300%;
        height: 300%;
        background: rgba(255, 255, 255, 0.1);
        transition: all 0.3s ease;
        z-index: -1;
        transform: translate(-50%, -50%) rotate(45deg);
      }

      .booking-button:hover::after,
      .cancel-button:hover::after {
        width: 200%;
        height: 200%;
      }

      /* Style for success button */
      .success-button {
        background-color: #007bff; /* Blue background color */
        color: #fff; /* White text color */
      }

      /* Style for failure button */
      .failure-button {
        background-color: #ff4d4d; /* Red background color */
        color: #fff; /* White text color */
      }
      /* Add this CSS for the success and failure buttons */
      .success-button,
      .failure-button {
        position: relative;
        background-color: #007bff; /* Default background color */
        color: #fff; /* Default text color */
        border: none;
        font-size: 20px;
        text-align: center;
        transition: background-color 0.3s, transform 0.3s;
        overflow: hidden;
        cursor: pointer;
        border-radius: 15px;
        margin: 10px;
        padding: 10px 20px;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
      }

      .failure-button:hover {
        transform: translateY(-5px);
      }
      .success-button:hover {
        transform: translateY(-5px);
      }
      .success-button:active,
      .failure-button:active {
        transform: translateY(2px);
      }

      .success-button:focus,
      .failure-button:focus {
        outline: none;
      }

      #content {
        width: 210mm; /* A4 width */
        height: 297mm; /* A4 height */
        padding: 10mm;
        box-sizing: border-box;
        margin: 0;
      }

      .clinicDetails {
        text-align: center;
        margin-bottom: 10px;
      }

      .clinicDetails h2 {
        color: cyan; /* Header color */
        margin: 0;
      }

      .clinicDetails p {
        margin: 5px 0;
      }

      .clinicDetails img {
        max-width: 150px;
        height: auto;
        margin-top: -20px;
      }

      .detailsContainer {
        display: flex;
        justify-content: space-between;
        border-radius: 10px;
        border: 1px solid black;
        padding: 10px;
      }

      .column {
        width: 30%;
        padding: 5px;
      }

      .column h6 {
        color: rgb(30, 140, 231); /* Header color */
        margin: 0;
      }

      .column p {
        margin: 5px 0;
        font-size: smaller;
      }

      .clinicalNotes {
        margin-top: 10px;
        border: 1px solid black;
        border-radius: 10px;
        /* padding: 10px; */
      }

      .clinicalNotesContainer {
        display: flex;
        justify-content: space-between;
        height: 750px;
      }

      .clinicalNote {
        width: 33%;
        /* padding: 10px; */
        box-sizing: border-box;
        border-right: 1px solid #131212; /* Border between columns */
        height: 100%;
      }

      .clinicalNote:last-child {
        border-right: none; /* Remove border on the last column */
        width: 67%;
      }

      .clinicalNote h5 {
        margin: 0px;
        padding: 3px;
        text-align: center;
        border-bottom: 1px solid black;
      }

      @media print {
        body {
          margin: 0;
          padding: 0;
        }

        #content {
          width: 210mm;
          min-height: 297mm;
          padding: 20mm;
          box-sizing: border-box;
        }
      }
    </style>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.3.1/jspdf.umd.min.js"></script>
  </head>
  <body>
    <div class="row" style="margin: 0; height: 100vh">
      <div class="col-lg-6">
        <div id="doctorProfileContainer">
          <!-- Doctor's profile will be added dynamically here -->
        </div>
      </div>
      <div class="col-lg-6">
        <div class="container mt-5 slot-container">
          <h3 class="text-primary mb-3">Available Booking Dates</h3>
          <!-- Slots will be added dynamically here -->
        </div>
        <div class="container booking-container">
          <!-- Appointment Booking Form -->
          <div class="booking-form">
            <h3 class="mb-4">Book Appointment</h3>
            <form id="appointmentForm">
              <input
                type="tel"
                id="patientMobile"
                placeholder="Your Mobile Number"
                required
              />
              <select id="patientDropdown" required>
                <option value="">Select Patient</option>
              </select>
              <input
                type="text"
                id="patientName"
                placeholder="Your Name"
                required
              />
              <select id="patientGender" required>
                <option value="">Select Gender</option>
                <option value="Male">Male</option>
                <option value="Female">Female</option>
                <option value="Other">Other</option>
              </select>
              <input
                type="number"
                id="patientAge"
                placeholder="Your Age"
                required
              />
              <div class="buttonContainer">
                <input type="submit" value="Proceed" />
                <button type="button" id="cancelButton" onclick="closeForm()">
                  Cancel
                </button>
              </div>
            </form>
          </div>
        </div>
        <div class="popup-overlay" id="popupOverlay">
          <div class="popup" id="mainPopup">
            <p>Please select an option:</p>
            <button id="doctorVisitBtn">Doctor Visit</button>
            <button id="reportBtn">Report</button>
          </div>

          <div class="popup" id="subPopup">
            <p>Choose Payment Method:</p>
            <button id="payToClinicBtn">Receive Payment</button>
            <button id="payToDoctorBtn">Pay to Doctor</button>
          </div>
        </div>
        <div class="container booking-confirmation"></div>
      </div>
    </div>

    <div id="printableContent" style="display: none">
      <!-- Content to be printed as PDF -->
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.9.3/html2pdf.bundle.min.js"></script>
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"
      crossorigin="anonymous"
    ></script>
    <!-- Add this script tag to include Axios -->
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script src="https://unpkg.com/pdf-lib@1.17.1/dist/pdf-lib.js"></script>

    <script>
      let slotData = [];
      let slotItems = [];
      //let SLOTS = [];
      let userData = null;
      let slotdetails = null;
      let slotTiming = null;
      document.addEventListener("DOMContentLoaded", function () {
        // Check if the user is already logged in
        const isLoggedIn = localStorage.getItem("isLoggedIn");
        if (isLoggedIn) {
          // Retrieve username from localStorage
          const username = localStorage.getItem("username");
          // Do something with the logged-in user's data
          const storedUserData = localStorage.getItem("userData");
          console.log(storedUserData);
          // Access and use the user's data
          if (storedUserData) {
            userData = JSON.parse(storedUserData).data;
            console.log(userData);
            // Set the logo URL dynamically
          }
          console.log(userData);
        }
      });

      // Function to get formatted date string in "DD Month" format
      function getFormattedDate(dateString) {
        const year = dateString.substring(0, 4);
        const month = dateString.substring(4, 6);
        const day = dateString.substring(6, 8);

        // Create a Date object using the parsed components
        const date = new Date(`${year}-${month}-${day}`);

        // Format the date as "DD Month"
        const options = { day: "numeric", month: "long" };
        return date.toLocaleDateString("en-US", options);
      }
      function formatDate(inputDate) {
        // Extract year, month, and day from the input string
        const year = inputDate.substring(0, 4);
        const month = inputDate.substring(4, 6);
        const day = inputDate.substring(6, 8);

        // Form the date in dd-mm-yyyy format
        const formattedDate = `${day}-${month}-${year}`;

        return formattedDate;
      }

      async function fetchSlotTimings(drId, slotId) {
        const url = "http://easyhealths.com/api/vuslot";
        const params = {
          DR_ID: drId,
          PHARMA_ID: "8",
          APPNT_ID: slotId,
        };

        try {
          const response = await axios.post(url, params);
          const data = response.data.Data ? response.data.Data : null;
          console.log(data);
          return data;
        } catch (error) {
          console.error("Error fetching slot data:", error);
          return null;
        }
      }

      // Function to generate slot items with dates
      function generateSlotItems(slotData) {
        //console.log(slotData);
        const slotContainer = document.querySelector(".slot-container");
        const slots = slotData;

        // Sort slots based on SCH_DT
        slots.sort((a, b) => {
          const dateA = new Date(slotData.SCH_DT);
          const dateB = new Date(slotData.SCH_DT);
          return dateA - dateB;
        });

        //console.log("slots data:", slots);
        for (let i = 0; i < slots.length; i += 2) {
          const slotItemPair = document.createElement("div");
          const slotItemTimings = document.createElement("div");
          const rowclass = "row" + i;
          slotItemTimings.classList.add("row", "slotTime", rowclass);
          slotItemPair.classList.add("row", "mb-3");
          for (let j = i; j < Math.min(i + 2, slots.length); j++) {
            const slot = slots[j];
            const date = new Date(slot.SCH_DT);
            const formattedDate = getFormattedDate(slot.SCH_DT);
            const dayName = slot.SCH_DAY;
            const slotItem = document.createElement("div");
            slotItem.classList.add("col-md-6");

            // Determine status text and color based on conditions
            let statusText, statusColor;
            if (
              slot.STATUS === "Booking Available" &&
              slot.CHK_IN_STS === "UPCOMING"
            ) {
              statusText = "Available";
              statusColor = "#7BF066";
            } else if (
              slot.STATUS === "Booking Available" &&
              slot.CHK_IN_STS === "IN"
            ) {
              statusText = "In Clinic";
              statusColor = "#7BF066";
            } else {
              statusText = "Not Available";
              statusColor = "red";
            }

            // Modify slotItem HTML to call handleSlotClick with slot data
            slotItem.innerHTML = `
                            <div class="slot-item">
                                <div class="date-day">${formattedDate}<br>${dayName}</div>
                                <div class="status" style="color: ${statusColor};">${statusText}</div>
                            </div>
                        `;

            slotItem.addEventListener("mouseenter", () => {
              //handleSlotClick(slot);

              //fetchSlotTimings(doctordata.DR_ID, slot.ID);
              //console.log(SLOTS);
              // slot.SLOTS = SLOTS ? SLOTS : null;
              // console.log(slot);
              // //console.log(slot);
              // if(slot.SLOTS[0]){

              // }
              generateSlotTimes(slot, j, rowclass);
            });
            slotItem.addEventListener("dblclick", () => {
              const slotTimeContainer = document.querySelector(`.${rowclass}`);
              slotTimeContainer.classList.remove("active"); // Remove 'active' class to trigger transition
            });

            slotItemPair.appendChild(slotItem);
            slotItems.push(slotItem);
          }
          slotContainer.appendChild(slotItemPair);
          slotContainer.appendChild(slotItemTimings);
        }
      }

      async function generateSlotTimes(slotData, j, rowclass) {
        const SLOTS = await fetchSlotTimings(doctordata.DR_ID, slotData.ID);

        let slotsTime = [];
        slotsTime.push(SLOTS);
        console.log(slotsTime);
        slotData.SLOTS = slotsTime;
        console.log(slotData);
        //console.log(slotData);
        const slottime = document.getElementsByClassName("slotTime");
        for (let i = 0; i < slottime.length; i++) {
          slottime[i].style.display = "none";
        }

        const slotContainer = document.querySelector(`.${rowclass}`);
        slotContainer.classList.add("active"); // Add 'active' class to trigger transition
        slotContainer.innerHTML = ``;
        slotContainer.style.display = "block";
        const slot = slotData;
        //console.log(slot);
        if (slot && slot.SLOTS[0]) {
          const iconUrls = {
            Morning: "/morning_icon.jpeg",
            Afternoon: "/afternoon_icon.jpeg",
            Evening: "/evening_icon.jpeg",
          };
          console.log(slot.SLOTS[0]);
          if (slot.SLOTS[0]) {
            ["Morning", "Afternoon", "Evening"].forEach((timePeriod) => {
              const slotsForPeriod = slot.SLOTS[0][timePeriod];
              console.log(slotsForPeriod);
              if (slotsForPeriod && slotsForPeriod.length > 0) {
                const timingCOntainer = document.createElement("div");
                const iconUrl = iconUrls[timePeriod];
                timingCOntainer.innerHTML += `<h4><img src="${iconUrl}" alt="${timePeriod} Icon" style="width: 40px; height: 40px;"> ${timePeriod} Slots</h4>`;
                // timingCOntainer.innerHTML += '<div class="slot-section">';
                // Iterate over slots for the current time period
                //console.log(slotsForPeriod);
                for (let i = 0; i < slotsForPeriod.length; i += 4) {
                  const slotItemPair = document.createElement("div");
                  slotItemPair.classList.add("row", "mb-3");
                  for (
                    let j = i;
                    j < Math.min(i + 4, slotsForPeriod.length);
                    j++
                  ) {
                    const timeSlot = slotsForPeriod[j];
                    const slottimeItem = document.createElement("div");
                    slottimeItem.classList.add("modal-slot-item", "col-md-3");
                    slottimeItem.dataset.slot = JSON.stringify(timeSlot);
                    slottimeItem.innerHTML = `
                            <span>${timeSlot.FROM} - ${timeSlot.TO}</span>
                            <div class="availability">Available</div>
                        `;
                    slotItemPair.appendChild(slottimeItem);
                    // console.log(JSON.parse(slottimeItem.dataset.slot));
                    console.log(slottimeItem);
                    slottimeItem.onclick = function () {
                      //console.log("inside the function");

                      const clickedSlotData = JSON.parse(
                        slottimeItem.dataset.slot
                      );
                      openBookingForm(clickedSlotData, slot);
                    };
                  }
                  timingCOntainer.appendChild(slotItemPair);
                }
                slotContainer.appendChild(timingCOntainer);
                //slotContainer.innerHTML="</div>"
              } else {
                const timingCOntainer = document.createElement("div");
                // Display message if no slots available for the current time period
                timingCOntainer.innerHTML += `<h4><img src="${iconUrls[timePeriod]}" alt="${timePeriod} Icon" style="width: 40px; height: 40px;"> ${timePeriod} Slots</h4>`;
                timingCOntainer.innerHTML +=
                  '<div class="no-slots-animation">No slots available</div>';
                slotContainer.appendChild(timingCOntainer);
              }
            });
          } else {
            // Handle case where slot data is missing or incorrect
            slotContainer.innerHTML = "Error: Slot data not available";
          }
        }

        // Attach event listener to slot time items
        const slotTimeItems = document.querySelectorAll(".modal-slot-item");
      }

      // Create a function to generate the doctor's profile page
      async function generateDoctorProfilePage(doctorData) {
        // Create container element
        const container = document.createElement("div");
        container.classList.add("container", "mt-5");
        const profileContainer = document.getElementById(
          "doctorProfileContainer"
        );
        // Create profile row
        const profileRow = document.createElement("div");
        profileRow.classList.add("row", "doctor-profile");

        // Create image column
        const imageCol = document.createElement("div");
        imageCol.classList.add("col-md-4", "col-sm-12", "doctor-image");
        const image = document.createElement("img");
        image.src = doctorData.DR_PHOTO;
        image.alt = doctorData.DR_NAME;
        image.classList.add("img-thumbnail");
        imageCol.appendChild(image);

        // Create info column
        const infoCol = document.createElement("div");
        infoCol.classList.add("col-md-8", "col-sm-12", "doctor-info");
        const nameHeader = document.createElement("h2");
        nameHeader.textContent = doctorData.DR_NAME;
        const designationPara = document.createElement("p");
        designationPara.classList.add("designation");
        designationPara.textContent = doctorData.DESIGNATION;
        const specializationDiv = document.createElement("div");
        specializationDiv.classList.add("specialization");
        specializationDiv.innerHTML = `<b>Specialization:</b> ${doctorData.D_CATG}`;
        const experienceDiv = document.createElement("div");
        experienceDiv.classList.add("experience");
        experienceDiv.innerHTML = `<b>Experience:</b> ${doctorData.EXPERIENCE}`;
        const qualificationDiv = document.createElement("div");
        qualificationDiv.classList.add("qualification");
        qualificationDiv.innerHTML = `<b>Qualification:</b> ${doctorData.QUALIFICATION}`;
        const feesDiv = document.createElement("div");
        feesDiv.classList.add("fees");
        feesDiv.innerHTML = `<b>Fees:</b> ${doctorData.DR_FEES}`;
        const idDiv = document.createElement("div");
        idDiv.classList.add("id");
        idDiv.innerHTML = `<b>ID:</b> ${doctorData.DR_ID}`;
        const mobileDiv = document.createElement("div");
        mobileDiv.classList.add("mobile");
        mobileDiv.innerHTML = `<b>Mobile:</b> ${doctorData.DR_MOBILE}`;
        const languageDiv = document.createElement("div");
        languageDiv.classList.add("language");
        languageDiv.innerHTML = `<b>Language:</b> ${doctorData.LANGUAGE}`;
        const sexDiv = document.createElement("div");
        sexDiv.classList.add("sex");
        sexDiv.innerHTML = `<b>Sex:</b> ${doctorData.SEX}`;
        // const appointmentButton = document.createElement("button");
        // appointmentButton.type = "button";
        // appointmentButton.classList.add(
        //   "btn",
        //   "btn-primary",
        //   "book-appointment"
        // );
        // appointmentButton.textContent = "Book Appointment";
        // appointmentButton.dataset.bsToggle = "modal";
        // appointmentButton.dataset.bsTarget = "#appointmentModal";

        // Append elements to info column
        infoCol.appendChild(nameHeader);
        infoCol.appendChild(designationPara);
        infoCol.appendChild(specializationDiv);
        infoCol.appendChild(experienceDiv);
        infoCol.appendChild(qualificationDiv);
        infoCol.appendChild(feesDiv);
        infoCol.appendChild(idDiv);
        infoCol.appendChild(mobileDiv);
        infoCol.appendChild(languageDiv);
        infoCol.appendChild(sexDiv);
        //infoCol.appendChild(appointmentButton);

        // Append columns to profile row
        profileRow.appendChild(imageCol);
        profileRow.appendChild(infoCol);

        // Create slots row (if needed)
        // You can add this part if you want to include available slots information

        // Append rows to container
        container.appendChild(profileRow);
        // Append container to body
        profileContainer.appendChild(container);
        // slotData = await fetchSlotData(doctorData.DR_ID);
        // slotData = slotData.data;
        slotData = doctordata.SCH_DT;
        // Call the function to generate slot items with dates
        generateSlotItems(slotData);
      }
      // Function to parse query string into object
      function queryStringToObject(queryString) {
        const params = new URLSearchParams(queryString);
        const obj = {};

        for (const [key, value] of params) {
          if (key === "SCH_DT") {
            // Parse slotData JSON string into object
            obj[key] = JSON.parse(decodeURIComponent(value));
          } else {
            obj[key] = decodeURIComponent(value);
          }
        }

        return obj;
      }
      // Parse URL parameters to get doctor's data
      const queryString = window.location.search;
      const doctordata = queryStringToObject(queryString);
      generateDoctorProfilePage(doctordata);
      console.log(doctordata);

      //Function to create booking form
      function openBookingForm(slotData, slot) {
        slotdetails = slotData;
        slotTiming = slot;
        console.log("Inside Booking form");
        const slotContainer = document.querySelector(".slot-container");
        const bookingContainer = document.querySelector(".booking-container");
        slotContainer.style.display = "none";
        bookingContainer.style.display = "block";
        const bookingForm = document.querySelector(".booking-form");

        bookingForm.style.display = "block"; // Show booking form
      }
      document
        .getElementById("patientMobile")
        .addEventListener("input", function (event) {
          const mobile = event.target.value;
          if (mobile.length <= 9 || mobile.length > 10) {
            const defaultOption = document.createElement("option");
            defaultOption.style.display = "none";
            const patientDropdown = document.getElementById("patientDropdown");
            patientDropdown.style.display = "none";
          }
          if (!isValidMobile(mobile)) {
            displayError(
              event.target,
              "Mobile number should be exactly 10 digits."
            );
            const patientDropdown = document.getElementById("patientDropdown");
            patientDropdown.style.display = "none";
          } else {
            if (mobile.length === 10 && !isNaN(mobile)) {
              // Call function to handle mobile number with 10 digits
              handleMobileNumberWith10Digits(mobile);
            }
            clearError(event.target);
          }
        });

      async function handleMobileNumberWith10Digits(mobile) {
        const url = "http://easyhealths.com/api/srchmob";
        const params = {
          MOBILE: mobile,
        };

        try {
          const response = await axios.post(url, params);
          const patients = response.data.data ? response.data.data : [];

          // Clear any previous dropdown options
          const selectElement = document.getElementById("patientDropdown");
          selectElement.innerHTML = "";
          console.log(patients);
          if (patients.length > 0) {
            // Show the dropdown/select element
            selectElement.style.display = "block";

            // Create default option
            const defaultOption = document.createElement("option");
            defaultOption.value = "";
            defaultOption.text = "Select Patient";
            selectElement.appendChild(defaultOption);

            // Populate dropdown options with patient data
            patients.forEach((patient) => {
              const option = document.createElement("option");
              option.value = patient.ID; // Store patient ID as option value

              // Store other patient details as data attributes
              option.dataset.name = patient.NAME;
              option.dataset.age = patient.AGE;
              option.dataset.sex = patient.SEX;
              option.dataset.familyId = patient.FAMILY_ID;
              // Set text content for the option
              option.textContent = `${patient.NAME} - Age: ${patient.AGE}, Sex: ${patient.SEX}`;

              selectElement.appendChild(option);
            });
          } else {
            // Hide the dropdown/select element if no data is available
            selectElement.style.display = "none";
            const defaultOption = document.createElement("option");
            defaultOption.style.display = "none";
            // Make name and age fields editable
            const patientNameInput = document.getElementById("patientName");
            const patientAgeInput = document.getElementById("patientAge");

            patientNameInput.removeAttribute("readonly");
            patientAgeInput.removeAttribute("readonly");
          }
        } catch (error) {
          console.error("Error fetching patient data:", error);
        }
      }
      // Function to check if a string contains only alphabets
      function isValidName(name) {
        return /^[a-zA-Z]+$/.test(name);
      }

      // Function to check if a mobile number is valid (exactly 10 digits)
      function isValidMobile(mobile) {
        return /^\d{10}$/.test(mobile);
      }

      // Function to check if age is not negative
      function isValidAge(age) {
        return age >= 0;
      }

      // Function to display error message
      function displayError(inputField, message) {
        const parentElement = inputField.parentElement;
        const errorElement = parentElement.querySelector(".error-message");

        // Create error message element if not already present
        if (!errorElement) {
          const errorMessage = document.createElement("div");
          errorMessage.classList.add("error-message");
          parentElement.appendChild(errorMessage);
          errorElement = errorMessage;
        }

        // Display error message
        errorElement.textContent = message;
      }

      // Function to clear error message
      function clearError(inputField) {
        const parentElement = inputField.parentElement;
        const errorElement = parentElement.querySelector(".error-message");

        // Clear error message
        if (errorElement) {
          parentElement.removeChild(errorElement);
        }
      }

      // Add event listeners to input fields for validation
      document
        .getElementById("patientName")
        .addEventListener("input", function (event) {
          const name = event.target.value;
          if (!isValidName(name)) {
            displayError(event.target, "Name should only contain alphabets.");
          } else {
            clearError(event.target);
          }
        });

      document
        .getElementById("patientAge")
        .addEventListener("input", function (event) {
          const age = parseInt(event.target.value);
          if (!isValidAge(age)) {
            displayError(event.target, "Age cannot be negative.");
          } else {
            clearError(event.target);
          }
        });

      function closeForm() {
        const slotContainer = document.querySelector(".slot-container");
        const bookingContainer = document.querySelector(".booking-container");
        slotContainer.style.display = "block";
        bookingContainer.style.display = "none";
        const bookingForm = document.querySelector(".booking-form");

        bookingForm.style.display = "none"; // Show booking form
      }
      // Modify form submission event listener to include validation
      document
        .getElementById("appointmentForm")
        .addEventListener("submit", async function (event) {
          event.preventDefault(); // Prevent default form submission

          const patientName = document.getElementById("patientName").value;
          const patientMobile = document.getElementById("patientMobile").value;
          const patientGender = document.getElementById("patientGender").value;
          const patientAge = parseInt(
            document.getElementById("patientAge").value
          );
          const patientDropdown = document.getElementById("patientDropdown");
          const selectedOption =
            patientDropdown.options[patientDropdown.selectedIndex];

          // Retrieve data from dataset attributes of the selected option
          const patientId = selectedOption.value; // This would be the entire patient object as a JSON string
          const patientNameFromDataset = selectedOption.dataset.name;
          const patientAgeFromDataset = selectedOption.dataset.age;
          const patientSexFromDataset = selectedOption.dataset.sex;
          const patientFamilyIdFromDataset = selectedOption.dataset.familyId;
          // Perform validation before submitting the form
          let isValid = true;

          if (!isValidName(patientName)) {
            displayError(
              document.getElementById("patientName"),
              "Name should only contain alphabets."
            );
            isValid = false;
          } else {
            clearError(document.getElementById("patientName"));
          }

          if (!isValidMobile(patientMobile)) {
            displayError(
              document.getElementById("patientMobile"),
              "Mobile number should be exactly 10 digits."
            );
            isValid = false;
          } else {
            clearError(document.getElementById("patientMobile"));
          }

          if (!isValidAge(patientAge)) {
            displayError(
              document.getElementById("patientAge"),
              "Age cannot be negative."
            );
            isValid = false;
          } else {
            clearError(document.getElementById("patientAge"));
          }

          // If all fields are valid, submit the form
          if (isValid) {
            // Make an API call to book appointment
            // You can add your API endpoint here
            console.log(userData);
            const patientDetails = {
              FAMILY_ID: patientFamilyIdFromDataset,
              PATIENT_ID: patientId,
              PATIENT_NAME: patientNameFromDataset,
              MOBILE: patientMobile,
              DR_ID: doctordata.DR_ID,
              DR_NAME: doctordata.DR_NAME,
              APNT_DT: slotTiming.SCH_DT,
              PHARMA_ID: userData.PHARMA_ID ? userData.PHARMA_ID : null,
              PHARMA_NAME: userData.PHARMA_NAME,
              APNT_ID: slotTiming.ID,
              FROM: slotdetails.FROM,
              TO: slotdetails.TO,
              DR_FEES: doctordata.DR_FEES,
            };
            console.log(patientDetails);
            showMainPopup(patientDetails, patientSexFromDataset,patientAgeFromDataset);
            // Reset form fields
            this.reset();

            // Hide booking form after submission
            document.querySelector(".booking-form").style.display = "none";
            // document.querySelector(".slot-container").style.display = "block";
          }
        });

      // Add event listener to the patient dropdown
      const patientDropdown = document.getElementById("patientDropdown");
      patientDropdown.addEventListener("change", function () {
        // Get the selected option from the dropdown
        const selectedOption = this.options[this.selectedIndex];

        // Populate input fields with selected patient data
        const patientNameInput = document.getElementById("patientName");
        const patientAgeInput = document.getElementById("patientAge");
        const patientGenderInput = document.getElementById("patientGender");

        patientNameInput.value = selectedOption.dataset.name; // Populate name input field
        patientAgeInput.value = selectedOption.dataset.age; // Populate age input field
        patientGenderInput.value = selectedOption.dataset.sex; // Populate gender input field

        // Make input fields non-editable
        patientNameInput.setAttribute("readonly", true);
        patientAgeInput.setAttribute("readonly", true);
        patientGenderInput.setAttribute("readonly", true);
      });

      // Function to show the main popup
      function showMainPopup(patientDetails, patientSexFromDataset,patientAgeFromDataset) {
        document.querySelector(".slot-container").style.display = "none";
        document.getElementById("popupOverlay").style.visibility = "visible";
        document.getElementById("mainPopup").style.display = "block";
        document.getElementById("subPopup").style.display = "none";

        // Handle Doctor Visit button click
        document
          .getElementById("doctorVisitBtn")
          .addEventListener("click", function () {
            patientDetails.BOOKING_TYPE = "drvisit";
            hideMainPopup();

            openBookingConfirmation(
              patientDetails,
              patientSexFromDataset,
              patientAgeFromDataset
            );
          });

        function openBookingConfirmation(
          patientDetails,
          patientSexFromDataset,
          patientAgeFromDataset
        ) {
          document.querySelector(".slot-container").style.display = "none";
          console.log(patientDetails);
          // Get the booking confirmation container
          const bookingConfirm = document.querySelector(
            ".booking-confirmation"
          );

          // Clear any previous content
          bookingConfirm.innerHTML = "";
          bookingConfirm.innerHTML = `<h2 class="confirmation-heading">
                Please Confirm Appointment Details
              </h2>`;
          // Create upper part for patient info
          const upperPart = document.createElement("div");
          upperPart.classList.add("patient-info", "info-container");

          let bookingDate = patientDetails.APNT_DT;
          var year = bookingDate.substring(0, 4);
          var month = bookingDate.substring(4, 6);
          var day = bookingDate.substring(6, 8);

          // Format the date into dd-mm-yyyy format
          bookingDate = day + "-" + month + "-" + year;
          let purpose = null;
          if (patientDetails.BOOKING_TYPE === "drvisit") {
            purpose = "Doctor Visit";
          }
          // Create lower part for doctor and appointment info
          const lowerPart = document.createElement("div");
          lowerPart.classList.add("appointment-info", "info-container");
          lowerPart.innerHTML = `
        <p><span>Patient</span>           : ${patientDetails.PATIENT_NAME}</p>
        <p><span>Age</span>               : ${patientAgeFromDataset}</p>
        <p><span>Gender</span>            : ${patientSexFromDataset}</p>
        <p><span>Contact Number</span>    : ${patientDetails.MOBILE}</p>
        <h4>Doctor Fees     : â‚¹ ${patientDetails.DR_FEES}</h4>

        `;

          upperPart.innerHTML = `
              <p><span>Doctor</span>            : ${patientDetails.DR_NAME}</p>
        <p><span>Chamber</span>           :${patientDetails.PHARMA_NAME}</p>
        <p><span>Booking Date </span>     : ${bookingDate}</p>
        <p><span>Timing </span>           : ${patientDetails.FROM} - ${patientDetails.TO}</p>
        <p><span>Booking Purpose</span>   :${purpose}</p>


      `;
          // Append upper and lower parts to the booking confirmation container
          bookingConfirm.appendChild(upperPart);
          bookingConfirm.appendChild(lowerPart);

          // Create buttons container
          const buttonsContainer = document.createElement("div");
          buttonsContainer.classList.add("buttons-container");

          // Create Book Appointment button
          const bookAppointmentBtn = document.createElement("button");
          bookAppointmentBtn.classList.add("booking-button");
          bookAppointmentBtn.textContent = "Book Appointment";
          //bookAppointmentBtn.style.backgroundColor = "#007bff"; // Blue color
          // Create Cancel button
          const cancelButton = document.createElement("button");
          cancelButton.classList.add("cancel-button");
          cancelButton.textContent = "Cancel";
          //cancelButton.style.backgroundColor = "#ff4d4d"; // Red color
          cancelButton.addEventListener("click", function () {
            const slotContainer = document.querySelector(".slot-container");
            const bookingContainer =
              document.querySelector(".booking-container");
            slotContainer.style.display = "none";
            bookingContainer.style.display = "block";
            const bookingForm = document.querySelector(".booking-form");
            bookingConfirm.style.display = "none";
            bookingForm.style.display = "block"; // Show booking form
          });

          // Append buttons to the buttons container
          buttonsContainer.appendChild(bookAppointmentBtn);
          buttonsContainer.appendChild(cancelButton);

          // Append buttons container to the booking confirmation container
          bookingConfirm.appendChild(buttonsContainer);

          // Show the booking confirmation container
          bookingConfirm.style.display = "block";

          bookAppointmentBtn.addEventListener("click", function () {
            // Handle booking appointment
            showSubPopup(
              patientDetails,
              patientSexFromDataset,
              patientAgeFromDataset
            );
          });
        }

        // Handle Report button click
        document
          .getElementById("reportBtn")
          .addEventListener("click", function () {
            patientDetails.BOOKING_TYPE = "report";
            hideMainPopup();
            console.log(`patient details`, patientDetails);
            // Perform logic for generating report
            console.log("Generating Report");
          });
      }

      // Function to hide the main popup
      function hideMainPopup() {
        //document.getElementById("popupOverlay").style.visibility = "hidden";
        document.getElementById("mainPopup").style.display = "none";
        document.getElementById("popupOverlay").style.visibility = "hidden";
      }
      async function bookAppointment(url, params) {
        try {
          const response = await axios.post(url, params);
          console.log(response.data);
          const responseData = response.data;
          return responseData;
        } catch (error) {
          console.error("Error fetching slot data:", error);
          return null;
        }
      }
      // Function to show the sub popup
      async function showSubPopup(patientDetails, gender, age) {
        document.getElementById("popupOverlay").style.visibility = "visible";
        document.getElementById("subPopup").style.display = "block";
        // Handle Pay to Clinic button click
        document
          .getElementById("payToClinicBtn")
          .addEventListener("click", function () {
            hideSubPopup();
            console.log(patientDetails);
            const url = "http://easyhealths.com/api/booking";
            const params = patientDetails;
            // Call bookAppointment and handle the promise
            bookAppointment(url, params)
              .then((responseData) => {
                console.log(responseData); // This should now log the actual response data
                if (responseData.Success) {
                  const bookingId = responseData.data
                    ? responseData.data.APPNT_TOKEN
                    : null;
                  showSuccessPopup(
                    "Booking Successful. Payment done",
                    bookingId,
                    patientDetails,
                    age,
                    gender
                  );
                } else {
                  const bookingId = responseData.data
                    ? responseData.data.APPNT_TOKEN
                    : null;
                  showFailurePopup(
                    "Patient already booked",
                    bookingId,
                    patientDetails,
                    age,
                    gender
                  );
                }
              })
              .catch((error) => {
                console.error("Error fetching slot data:", error);
              });

            // Perform logic for paying to clinic
            console.log("Paying to Clinic");
          });

        // Handle Pay to Doctor button click
        document
          .getElementById("payToDoctorBtn")
          .addEventListener("click", function () {
            hideSubPopup();
            hideSubPopup();
            console.log(patientDetails);
            const url = "http://easyhealths.com/api/booking";
            const params = patientDetails;
            // Call bookAppointment and handle the promise
            bookAppointment(url, params)
              .then((responseData) => {
                console.log(responseData); // This should now log the actual response data
                if (responseData.Success) {
                  const bookingId = responseData.data
                    ? responseData.data.APPNT_TOKEN
                    : null;
                  showSuccessPopup(
                    `Booking Successful.\nPay â‚¹ ${patientDetails.DR_FEES} to Doctor`,
                    bookingId,
                    patientDetails,
                    age,
                    gender
                  );
                } else {
                  const bookingId = responseData.data
                    ? responseData.data.APPNT_TOKEN
                    : null;
                  console.log(patientDetails);
                  showFailurePopup(
                    `Patient already booked.\nPay â‚¹ ${patientDetails.DR_FEES}`,
                    bookingId,
                    patientDetails,
                    age,
                    gender
                  );
                }
              })
              .catch((error) => {
                console.error("Error fetching slot data:", error);
              });

            // Perform logic for paying to clinic
            console.log("Paying to Clinic");
          });
      }
      // Function to show success popup
      function showSuccessPopup(
        message,
        bookingId,
        patientDetails,
        age,
        gender
      ) {
        const successPopup = document.createElement("div");
        successPopup.classList.add("popup");
        successPopup.id = "successPopup"; // Assign an id for styling
        successPopup.innerHTML = `<p>${message}</p><p>Booking Id: ${bookingId}</p>`;
        successPopup.innerHTML += `<button id="successBtn" class="success-button">OK</button>`; // Add class for styling
        document.getElementById("popupOverlay").appendChild(successPopup);
        document.getElementById("popupOverlay").style.visibility = "visible";

        // Add event listener for the success button
        const successBtn = document.getElementById("successBtn");
        successBtn.addEventListener("click", function () {
          let formattedDate = formatDate(patientDetails.APNT_DT);
          const visitTime = patientDetails.FROM + `-` + patientDetails.TO;
          const doctorData = {
            DR_NAME: patientDetails.DR_NAME,
            DR_ID: patientDetails.DR_ID,
            DESIGNATION: doctordata.DESIGNATION,
            VisitDate: formattedDate,
            VisitTime: visitTime,
          };
          const patientdetails = {
            PATIENT_NAME: patientDetails.PATIENT_NAME,
            Booking_ID: bookingId,
            Age: age,
            Gender: gender,
            Mobile: patientDetails.Mobile,
          };
          const clinicData = {
            PHARMA_NAME: userData.PHARMA_NAME,
            ADDRESS: userData.ADDRESS,
            CITY: userData.CITY,
            STATE: userData.STATE,
            PIN: userData.PIN,
            LOGO_URL: userData.LOGO_URL,
          };
          generatePDF(doctorData, clinicData, patientdetails);
          //location.reload(); // Reload the page on button click
        });
      }

      // Function to show failure popup
      function showFailurePopup(
        message,
        bookingId,
        patientDetails,
        age,
        gender
      ) {
        const failurePopup = document.createElement("div");
        failurePopup.classList.add("popup");
        failurePopup.id = "failurePopup"; // Assign an id for styling
        failurePopup.innerHTML = `<p>${message}</p><p>Booking Id: ${bookingId}</p>`;
        failurePopup.innerHTML += `<button id="failureBtn" class="failure-button">OK</button>`; // Add class for styling
        document.getElementById("popupOverlay").appendChild(failurePopup);
        document.getElementById("popupOverlay").style.visibility = "visible";

        // Add event listener for the failure button
        const failureBtn = document.getElementById("failureBtn");
        failureBtn.addEventListener("click", function () {
          console.log(patientDetails);
          let formattedDate = formatDate(patientDetails.APNT_DT);
          const visitTime = patientDetails.FROM + `-` + patientDetails.TO;
          const doctorData = {
            DR_NAME: patientDetails.DR_NAME,
            DR_ID: patientDetails.DR_ID,
            DESIGNATION: doctordata.DESIGNATION,
            VisitDate: formattedDate,
            VisitTime: visitTime,
          };
          const patientdetails = {
            PATIENT_NAME: patientDetails.PATIENT_NAME,
            Booking_ID: bookingId,
            Age: age,
            Gender: gender,
            Mobile: patientDetails.MOBILE,
          };
          const clinicData = {
            PHARMA_NAME: userData.PHARMA_NAME,
            ADDRESS: userData.ADDRESS,
            CITY: userData.CITY,
            STATE: userData.STATE,
            PIN: userData.PIN,
            LOGO_URL: userData.LOGO_URL,
          };
          generatePDF(doctorData, clinicData, patientdetails);
          //location.reload(); // Reload the page on button click
        });
      }

      // Function to hide the sub popup
      function hideSubPopup() {
        document.getElementById("popupOverlay").style.visibility = "hidden";
        document.getElementById("subPopup").style.display = "none";
      }

   

      function generatePDF(doctorData, clinicData, patientDetails) {
        const imageUrl = "http://easyhealths.com/storage/app/cliniclogo/8L.jpg";
        
        const element = document.createElement("div");

        // Construct the HTML content for the PDF
        element.innerHTML = ` <div id="content">
        <div class="clinicDetails">
            <img src="suraksha.jpg" alt="Clinic Logo">
            <h2>${userData.PHARMA_NAME}</h2>
            <p><strong>${userData.ADDRESS}</strong></p>
        </div>
        <div class="detailsContainer">
            
            <div class="column doctorDetails">
                <h6>Doctor Details</h6>
                <p><strong>Name:</strong> ${doctorData.DR_NAME}</p>
                <p><strong>Doctor ID:</strong> ${doctorData.DR_ID}</p>
                <p><strong>Designation:</strong> ${doctorData.DESIGNATION}</p>
            </div>
            <div class="column patientDetails">
                <h6>Patient Details</h6>
                <p><strong>Name:</strong>${patientDetails.PATIENT_NAME}</p>
                <p><strong>Age:</strong> ${patientDetails.Age}</p>
                <p><strong>Gender:</strong> ${patientDetails.Gender}</p>
                <p><strong>Mobile:</strong> ${patientDetails.Mobile}</p>
            </div>
            <div class="column appointmentDetails">
                <h6>Appointment Details</h6> 
                <p><strong>Booking ID:</strong> ${patientDetails.Booking_ID}</p>
                <p><strong>Visit Date:</strong> ${doctorData.VisitDate}</p>
                <p><strong>Visit Time:</strong>  ${doctorData.VisitTime}</p>
            </div>
        </div>

        <!-- Rounded bordered rectangular table for clinical notes and advice -->
        <div class="clinicalNotes">
            <div class="clinicalNotesContainer">
                <div class="clinicalNote">
                    <!-- First column content (Clinical Notes) -->
                    <h5>Clinical Notes</h5>
                    <!-- Add clinical notes content here -->
                </div>
                <div class="clinicalNote">
                    <!-- Second column content (Advice) -->
                    <h5>Advice</h5>
                    <!-- Add advice content here -->
                </div>
            </div>
        </div>
    </div>`;

        // // Apply additional styles for PDF rendering
        // element.style.padding = "10px";
        // element.style.border = "1px solid #ccc";
        // element.style.borderRadius = "10px";

        // Configure PDF options
        // Ensure the image is fully loaded before generating the PDF
        // Preload the image and wait for it to load completely
        const clinicLogo = new Image();
        clinicLogo.src = clinicData.LOGO_URL;

        clinicLogo.onload = function () {
          // Once the image is loaded, proceed with generating the PDF
          const opt = {
            filename: `booking_confirmation_${patientDetails.Booking_ID}.pdf`,
            image: { type: "jpeg", quality: 0.98 },
            html2canvas: { scale: 1.5 }, // Adjust scale based on testing
            jsPDF: { unit: "in", format: "a4", orientation: "portrait" },
          };

          // Use html2pdf to generate PDF from the element containing the image
          html2pdf()
            .set(opt)
            .from(element)
            .toPdf()
            .output("datauristring")
            .then(function (pdfDataUri) {
              const pdfWindow = window.open();
              pdfWindow.document.write(
                '<iframe width="100%" height="100%" src="' +
                  pdfDataUri +
                  '" frameborder="0"></iframe>'
              );
              pdfWindow.document.close();

              // Automatically focus the new window/tab
              pdfWindow.focus();
            });
        };

        clinicLogo.onerror = function () {
          console.error("Failed to load clinic logo:", clinicData.LOGO_URL);
        };
      }
    </script>
  </body>
</html>
