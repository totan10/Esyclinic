<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Doctor's Profile - Dr. Ashutosh Samal</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
      crossorigin="anonymous"
    />
    <style>
      /* Add custom styles here */
      body {
        margin: 0;
        padding: 0;
      }
      #doctorProfileContainer {
        margin: 0;
        max-width: fit-content;
      }
      .doctor-profile {
        margin-bottom: 30px;
        display: flex;
        justify-content: flex-start;
      }

      .doctor-image {
        margin-right: 30px;
        flex-shrink: 0; /* Prevent image from shrinking */
        width: 200px; /* Adjust image width */
        height: fit-content; /* Maintain aspect ratio */
      }
      .doctor-image img {
        border: 2px solid #f8f9fa;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1); /* Add shadow effect */
        z-index: 2;
      }
      .doctor-info {
        flex: 1;
      }

      .designation {
        margin-bottom: 10px;
        font-weight: bold;
      }

      .specialization,
      .experience,
      .qualification {
        margin-bottom: 5px;
      }

      .fees,
      .id,
      .mobile,
      .language,
      .sex {
        margin-bottom: 5px;
      }

      .appointments {
        text-align: center;
      }

      .slot-container {
        max-width: 50%;
      }
      /* Add modern 3D look to rounded rectangles */
      .slot-item {
        background-color: #00b2c8;
        border-radius: 25px;
        padding: 30px; /* Increase padding */
        margin-bottom: 20px;
        cursor: pointer;
        box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
        transition: transform 0.3s ease;
      }

      .slot-item:hover {
        transform: translateY(-5px);
      }

      .slot-item h3 {
        color: white;
      }
      .date-day {
        color: white;
        text-align: center;
        font-weight: 700;
      }
    </style>
  </head>
  <body>
    <div class="row">
      <div class="col-lg-6">
        <div id="doctorProfileContainer">
          <!-- Doctor's profile will be added dynamically here -->
        </div>
      </div>
      <div class="col-lg-6">
        <div class="container mt-5 slot-container">
          <h3 class="text-primary mb-3">Available Booking Dates</h3>
          <!-- Slots will be added dynamically here -->
        </div>
      </div>
    </div>

    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"
      crossorigin="anonymous"
    ></script>
    <!-- Add this script tag to include Axios -->
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script>
      // Function to get formatted date string in "DD Month" format
      function getFormattedDate(date) {
        const options = { day: "numeric", month: "long" };
        return date.toLocaleDateString("en-US", options);
      }

      // Function to get the next 6 days including today
      function getNextSixDays() {
        const dates = [];
        for (let i = 0; i < 6; i++) {
          const date = new Date();
          date.setDate(date.getDate() + i);
          dates.push(date);
        }
        return dates;
      }

      // Function to generate slot items with dates
      function generateSlotItems() {
        const slotContainer = document.querySelector(".slot-container");
        const dates = getNextSixDays();

        // Loop through each date and create a slot item
        for (let i = 0; i < dates.length; i += 2) {
          const slotItemPair = document.createElement("div");
          slotItemPair.classList.add("row", "mb-3");

          for (let j = i; j < Math.min(i + 2, dates.length); j++) {
            const date = dates[j];
            const formattedDate = getFormattedDate(date);
            const dayName = date.toLocaleDateString("en-US", {
              weekday: "long",
            });

            const slotItem = document.createElement("div");
            slotItem.classList.add("col-md-6");

            slotItem.innerHTML = `
        <div class="slot-item" onclick="handleSlotClick()">
          <div class="date-day">${formattedDate}<br>${dayName}</div>
        </div>
      `;

            slotItemPair.appendChild(slotItem);
          }

          slotContainer.appendChild(slotItemPair);
        }
      }

      // Call the function to generate slot items with dates
      generateSlotItems();

      // Make a POST API call to fetch slot data using Axios
      async function fetchSlotData(drId) {
        const url = "http://easyhealths.com/api/availdr";
        const params = {
          DRID: drId,
          PHARMAID: "8",
        };

        try {
          const response = await axios.post(url, params);
          // Axios automatically throws an error for non-2xx responses, so no need for explicit check
          const data = response.data;
          return data;
        } catch (error) {
          console.error("Error fetching slot data:", error);
          return null;
        }
      }

      // Create a function to generate the doctor's profile page
      async function generateDoctorProfilePage(doctorData) {
        // Create container element
        const container = document.createElement("div");
        container.classList.add("container", "mt-5");
        const profileContainer = document.getElementById(
          "doctorProfileContainer"
        );
        // Create profile row
        const profileRow = document.createElement("div");
        profileRow.classList.add("row", "doctor-profile");

        // Create image column
        const imageCol = document.createElement("div");
        imageCol.classList.add("col-md-4", "col-sm-12", "doctor-image");
        const image = document.createElement("img");
        image.src = doctorData.DR_PHOTO;
        image.alt = doctorData.DR_NAME;
        image.classList.add("img-thumbnail");
        imageCol.appendChild(image);

        // Create info column
        const infoCol = document.createElement("div");
        infoCol.classList.add("col-md-8", "col-sm-12", "doctor-info");
        const nameHeader = document.createElement("h2");
        nameHeader.textContent = doctorData.DR_NAME;
        const designationPara = document.createElement("p");
        designationPara.classList.add("designation");
        designationPara.textContent = doctorData.DESIGNATION;
        const specializationDiv = document.createElement("div");
        specializationDiv.classList.add("specialization");
        specializationDiv.innerHTML = `<b>Specialization:</b> ${doctorData.D_CATG}`;
        const experienceDiv = document.createElement("div");
        experienceDiv.classList.add("experience");
        experienceDiv.innerHTML = `<b>Experience:</b> ${doctorData.EXPERIENCE}`;
        const qualificationDiv = document.createElement("div");
        qualificationDiv.classList.add("qualification");
        qualificationDiv.innerHTML = `<b>Qualification:</b> ${doctorData.QUALIFICATION}`;
        const feesDiv = document.createElement("div");
        feesDiv.classList.add("fees");
        feesDiv.innerHTML = `<b>Fees:</b> ${doctorData.DR_FEES}`;
        const idDiv = document.createElement("div");
        idDiv.classList.add("id");
        idDiv.innerHTML = `<b>ID:</b> ${doctorData.DR_ID}`;
        const mobileDiv = document.createElement("div");
        mobileDiv.classList.add("mobile");
        mobileDiv.innerHTML = `<b>Mobile:</b> ${doctorData.DR_MOBILE}`;
        const languageDiv = document.createElement("div");
        languageDiv.classList.add("language");
        languageDiv.innerHTML = `<b>Language:</b> ${doctorData.LANGUAGE}`;
        const sexDiv = document.createElement("div");
        sexDiv.classList.add("sex");
        sexDiv.innerHTML = `<b>Sex:</b> ${doctorData.SEX}`;
        const appointmentButton = document.createElement("button");
        appointmentButton.type = "button";
        appointmentButton.classList.add(
          "btn",
          "btn-primary",
          "book-appointment"
        );
        appointmentButton.textContent = "Book Appointment";
        appointmentButton.dataset.bsToggle = "modal";
        appointmentButton.dataset.bsTarget = "#appointmentModal";

        // Append elements to info column
        infoCol.appendChild(nameHeader);
        infoCol.appendChild(designationPara);
        infoCol.appendChild(specializationDiv);
        infoCol.appendChild(experienceDiv);
        infoCol.appendChild(qualificationDiv);
        infoCol.appendChild(feesDiv);
        infoCol.appendChild(idDiv);
        infoCol.appendChild(mobileDiv);
        infoCol.appendChild(languageDiv);
        infoCol.appendChild(sexDiv);
        infoCol.appendChild(appointmentButton);

        // Append columns to profile row
        profileRow.appendChild(imageCol);
        profileRow.appendChild(infoCol);

        // Create slots row (if needed)
        // You can add this part if you want to include available slots information

        // Append rows to container
        container.appendChild(profileRow);
        // Append container to body
        profileContainer.appendChild(container);
        const slotData = await fetchSlotData(doctorData.DR_ID);
        console.log(slotData);
      }
      // Parse URL parameters to get doctor's data
      const queryString = window.location.search;
      const urlParams = new URLSearchParams(queryString);
      const doctor = Object.fromEntries(urlParams.entries());
      const doctorData = doctor;
      generateDoctorProfilePage(doctorData);
      // Call the function to generate the page

      // Add event listener to handle modal opening
      document
        .querySelector(".book-appointment")
        .addEventListener("click", function () {
          var myModal = new bootstrap.Modal(
            document.getElementById("appointmentModal")
          );
          myModal.show();
        });
      // Add event listener to handle modal closing
      document
        .getElementById("appointmentModal")
        .addEventListener("hidden.bs.modal", function () {
          // Remove the modal backdrop when the modal is closed
          document.querySelector(".modal-backdrop").remove();
        });

      // Handle form submission if needed
      document
        .getElementById("appointmentForm")
        .addEventListener("submit", function (event) {
          // Prevent default form submission
          event.preventDefault();
          // Handle form submission logic here
          // You can use JavaScript to process the form data or send it to a server via AJAX
          // After processing, you can close the modal if needed:
          // var myModal = new bootstrap.Modal(document.getElementById('appointmentModal'));
          // myModal.hide();
        });

      function handleSlotClick() {
        // You can implement logic here for handling slot click
        alert("Slot clicked!");
      }
    </script>
  </body>
</html>
