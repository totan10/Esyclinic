<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Doctor's Profile - Dr. Ashutosh Samal</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
      crossorigin="anonymous"
    />
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css"
      rel="stylesheet"
    />

    <style>
      /* Add custom styles here */
      body {
        margin: 0;
        padding: 0;
        background-color: #f8f9fa;
      }
      #doctorProfileContainer {
        margin: 0;
        max-width: fit-content;
      }
      .doctor-profile {
        margin-bottom: 30px;
        display: flex;
        justify-content: flex-start;
      }
      .doctor-image {
        margin-right: 30px;
        flex-shrink: 0; /* Prevent image from shrinking */
        width: 200px; /* Adjust image width */
        height: fit-content; /* Maintain aspect ratio */
      }
      .doctor-image img {
        border: 2px solid #f8f9fa;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1); /* Add shadow effect */
        z-index: 2;
      }
      .doctor-info {
        flex: 1;
      }
      .designation {
        margin-bottom: 10px;
        font-weight: bold;
      }
      .specialization,
      .experience,
      .qualification {
        margin-bottom: 5px;
      }
      .fees,
      .id,
      .mobile,
      .language,
      .sex {
        margin-bottom: 5px;
      }
      .appointments {
        text-align: center;
      }
      .slot-container {
        max-width: 100%;
      }
      /* Add modern 3D look to rounded rectangles */
      .slot-item {
        background-color: #00b2c8;
        border-radius: 25px;
        padding: 30px; /* Increase padding */
        margin-bottom: 20px;
        cursor: pointer;
        box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
        transition: transform 0.3s ease;
        z-index: 0;
        position: relative;
      }
      .slot-item:hover {
        transform: translateY(-5px);
      }
      .slot-item h3 {
        color: white;
      }
      .date-day {
        color: white;
        text-align: center;
        font-weight: 700;
        font-size: x-large;
      }
      .status {
        text-align: center;
        font-size: x-large;
        font-weight: 700;
      }
      /* Add a new class for slot timings within the modal */
      .modal-slot-item {
        background-color: transparent;
        border: 2px solid rgb(54, 53, 53);
        border-radius: 25px;
        padding: 5px; /* Adjust padding */
        margin-right: 10px; /* Add margin between slot items */
        margin-bottom: 10px; /* Adjust margin bottom */
        cursor: pointer;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1); /* Add shadow effect */
        transition: transform 0.3s ease, background-color 0.3s ease; /* Add transition for transform and background-color */
        width: 23%;
        z-index: 991;
      }
      /* Display a maximum of six slot timings per row */
      .slot-section {
        display: flex;
        flex-wrap: wrap;
        justify-content: flex-start;
        opacity: 0; /* Initially hide the slots */
        transition: opacity 0.3s ease; /* Add transition effect for opacity */
      }
      .slot-section.active {
        opacity: 1; /* Show the slots when active */
      }
      /* Style for timing text */
      .modal-slot-item span {
        color: #1b18b0; /* Blue color */
        text-align: center;
        display: block;
        margin-bottom: 5px;
        font-size: medium;
        transition: color 0.3s ease; /* Add transition for color change */
      }
      /* Style for availability text */
      .modal-slot-item .availability {
        color: rgb(3, 83, 3); /* Green color */
        margin: 0;
        text-align: center;
        font-size: medium;
      }
      .modal-slot-item:hover {
        transform: translateY(-5px);
        background-color: #00b2c8; /* Change background color on hover */
      }
      .modal-slot-item:hover span {
        color: white; /* Change text color on hover */
      }
      .slotTime {
        display: none;
        max-height: 0;
        transition: max-height 1s ease; /* Add transition effect for opening and closing */
        overflow: hidden; /* Hide overflowing content */
      }

      .slotTime.active {
        display: block;
        max-height: 2000px; /* Adjust the max height as per your content */
        transition: max-height 1s ease;
        position: relative;
        z-index: 3;
      }

      .booking-form {
        margin-top: 20px;
        padding: 20px;
        border: 1px solid #ccc;
        border-radius: 10px;
        background-color: #fff;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        height: 60%;
        position: relative;
      }
      .booking-form input[type="text"],
      .booking-form input[type="tel"],
      .booking-form select,
      #patientAge {
        width: 100%;
        margin-bottom: 10px;
        padding: 10px;
        border: 1px solid #ccc;
        border-radius: 5px;
        transition: border-color 0.15s ease-in-out, box-shadow 0.15s ease-in-out;
      }
      .booking-form input[type="submit"] {
        /* width: 100%; */
        padding: 10px;
        background-color: #007bff;
        color: #fff;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        transition: background-color 0.15s ease-in-out;
        position: absolute;
        bottom: 20px;
        left: 25%;
      }
      .booking-form input[type="submit"]:hover {
        background-color: #0056b3;
      }

      #cancelButton {
        padding: 10px;
        background-color: #ff4d4d; /* Red background */
        color: white;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        width: 20%;
        transition: background-color 0.15s ease-in-out;
        position: absolute;
        bottom: 20px;
        right: 25%;
      }

      #cancelButton:hover {
        background-color: #cc0000; /* Darker red on hover */
      }

      /* CSS animations for form elements */
      .booking-form input[type="text"],
      .booking-form input[type="tel"],
      .booking-form select,
      #patientAge,
      #patientDropdown .booking-form input[type="submit"],
      #cancelButton {
        transition: transform 0.3s ease-in-out;
      }
      #patientDropdown {
        display: none;
      }
      .booking-form input[type="text"]:focus,
      .booking-form input[type="tel"]:focus,
      .booking-form select:focus,
      #patientAge:focus,
      #patientDropdown:focus .booking-form input[type="submit"]:focus,
      #cancelButton:focus {
        transform: scale(1.05); /* Scale up on focus */
      }

      /* Set height of the booking form to match the screen height */
      .booking-container {
        height: 100vh;
        display: none;
        justify-content: center;
        align-items: center;
      }

      /* Add animation to the booking form */
      .booking-form {
        animation: slideInFromLeft 1s ease;
      }

      @keyframes slideInFromLeft {
        0% {
          transform: translateX(-100%);
          opacity: 0;
        }
        100% {
          transform: translateX(0);
          opacity: 1;
        }
      }
    </style>
  </head>
  <body>
    <div class="row" style="margin: 0; height: 100vh">
      <div class="col-lg-6">
        <div id="doctorProfileContainer">
          <!-- Doctor's profile will be added dynamically here -->
        </div>
      </div>
      <div class="col-lg-6">
        <div class="container mt-5 slot-container">
          <h3 class="text-primary mb-3">Available Booking Dates</h3>
          <!-- Slots will be added dynamically here -->
        </div>
        <div class="container booking-container">
          <!-- Appointment Booking Form -->
          <div class="booking-form">
            <h3 class="mb-4">Book Appointment</h3>
            <form id="appointmentForm">
              <input
                type="tel"
                id="patientMobile"
                placeholder="Your Mobile Number"
                required
              />
              <select id="patientDropdown" required>
                <option value="">Select Patient</option>
              </select>
              <input
                type="text"
                id="patientName"
                placeholder="Your Name"
                required
              />
              <select id="patientGender" required>
                <option value="">Select Gender</option>
                <option value="Male">Male</option>
                <option value="Female">Female</option>
                <option value="Other">Other</option>
              </select>
              <input
                type="number"
                id="patientAge"
                placeholder="Your Age"
                required
              />
              <input type="submit" value="Book Appointment" />
              <button type="button" id="cancelButton">Cancel</button>
            </form>
          </div>
        </div>
      </div>
    </div>

    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"
      crossorigin="anonymous"
    ></script>
    <!-- Add this script tag to include Axios -->
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script>
      let slotData = [];
      let slotItems = [];
      let SLOTS = [];
      let userData = null;
      let slotdetails = null;
      let slotTiming = null;
      document.addEventListener("DOMContentLoaded", function () {
        // Check if the user is already logged in
        const isLoggedIn = localStorage.getItem("isLoggedIn");
        if (isLoggedIn) {
          // Retrieve username from localStorage
          const username = localStorage.getItem("username");
          // Do something with the logged-in user's data
          const storedUserData = localStorage.getItem("userData");

          // Access and use the user's data
          if (storedUserData) {
            userData = JSON.parse(storedUserData).data;
            console.log(userData);
            // Set the logo URL dynamically
          }
        }
      });
      // Function to get formatted date string in "DD Month" format
      function getFormattedDate(dateString) {
        const year = dateString.substring(0, 4);
        const month = dateString.substring(4, 6);
        const day = dateString.substring(6, 8);

        // Create a Date object using the parsed components
        const date = new Date(`${year}-${month}-${day}`);

        // Format the date as "DD Month"
        const options = { day: "numeric", month: "long" };
        return date.toLocaleDateString("en-US", options);
      }

      // Function to generate slot items with dates
      function generateSlotItems(slotData) {
        console.log(slotData);
        const slotContainer = document.querySelector(".slot-container");
        const slots = slotData;

        // Sort slots based on SCH_DT
        slots.sort((a, b) => {
          const dateA = new Date(slotData.SCH_DT);
          const dateB = new Date(slotData.SCH_DT);
          return dateA - dateB;
        });

        console.log("slots data:", slots);
        for (let i = 0; i < slots.length; i += 2) {
          const slotItemPair = document.createElement("div");
          const slotItemTimings = document.createElement("div");
          const rowclass = "row" + i;
          slotItemTimings.classList.add("row", "slotTime", rowclass);
          slotItemPair.classList.add("row", "mb-3");
          for (let j = i; j < Math.min(i + 2, slots.length); j++) {
            const slot = slots[j];
            const date = new Date(slot.SCH_DT);
            const formattedDate = getFormattedDate(slot.SCH_DT);
            const dayName = slot.SCH_DAY;
            const slotItem = document.createElement("div");
            slotItem.classList.add("col-md-6");

            // Determine status text and color based on conditions
            let statusText, statusColor;
            if (
              slot.STATUS === "Booking Available" &&
              slot.CHK_IN_STS === "UPCOMING"
            ) {
              statusText = "Available";
              statusColor = "#7BF066";
            } else if (
              slot.STATUS === "Booking Available" &&
              slot.CHK_IN_STS === "IN"
            ) {
              statusText = "In Clinic";
              statusColor = "#7BF066";
            } else {
              statusText = "Not Available";
              statusColor = "red";
            }

            // Modify slotItem HTML to call handleSlotClick with slot data
            slotItem.innerHTML = `
                        <div class="slot-item">
                            <div class="date-day">${formattedDate}<br>${dayName}</div>
                            <div class="status" style="color: ${statusColor};">${statusText}</div>
                        </div>
                    `;

            slotItem.addEventListener("mouseenter", () => {
              //handleSlotClick(slot);

              fetchSlotTimings(doctordata.DR_ID, slot.ID);
              console.log(SLOTS);
              slot.SLOTS = SLOTS ? SLOTS : null;
              console.log(slot);
              generateSlotTimes(slot, j, rowclass);
            });
            slotItem.addEventListener("click", () => {
              const slotContainer = document.querySelector(`.${rowclass}`);
              slotContainer.classList.remove("active"); // Remove 'active' class to trigger transition
            });

            slotItemPair.appendChild(slotItem);
            slotItems.push(slotItem);
          }
          slotContainer.appendChild(slotItemPair);
          slotContainer.appendChild(slotItemTimings);
        }
      }
      async function fetchSlotTimings(drId, slotId) {
        const url = "http://easyhealths.com/api/vuslot";
        const params = {
          DR_ID: drId,
          PHARMA_ID: "8",
          APPNT_ID: slotId,
        };

        try {
          const response = await axios.post(url, params);
          const data = response.data.Data ? response.data.Data : null;
          SLOTS[0] = data;
          console.log(SLOTS);
          return SLOTS;
        } catch (error) {
          console.error("Error fetching slot data:", error);
          return null;
        }
      }
      function generateSlotTimes(slotData, j, rowclass) {
        console.log(slotData);
        const slottime = document.getElementsByClassName("slotTime");
        for (let i = 0; i < slottime.length; i++) {
          slottime[i].style.display = "none";
        }

        const slotContainer = document.querySelector(`.${rowclass}`);
        slotContainer.classList.add("active"); // Add 'active' class to trigger transition
        slotContainer.innerHTML = ``;
        slotContainer.style.display = "block";
        const slot = slotData;
        console.log(slot);
        if (slot && slot.SLOTS) {
          const iconUrls = {
            Morning: "/morning_icon.jpeg",
            Afternoon: "/afternoon_icon.jpeg",
            Evening: "/evening_icon.jpeg",
          };

          ["Morning", "Afternoon", "Evening"].forEach((timePeriod) => {
            const slotsForPeriod = slot.SLOTS[0][timePeriod];
            console.log(slotsForPeriod);
            if (slotsForPeriod && slotsForPeriod.length > 0) {
              const iconUrl = iconUrls[timePeriod];
              slotContainer.innerHTML += `<h4><img src="${iconUrl}" alt="${timePeriod} Icon" style="width: 40px; height: 40px;"> ${timePeriod} Slots</h4>`;
              slotContainer.innerHTML += '<div class="slot-section">';
              // Iterate over slots for the current time period
              console.log(slotsForPeriod);
              for (let i = 0; i < slotsForPeriod.length; i += 4) {
                const slotItemPair = document.createElement("div");
                slotItemPair.classList.add("row", "mb-3");
                for (
                  let j = i;
                  j < Math.min(i + 4, slotsForPeriod.length);
                  j++
                ) {
                  const timeSlot = slotsForPeriod[j];
                  const slottimeItem = document.createElement("div");
                  slottimeItem.classList.add("modal-slot-item", "col-md-3");
                  slottimeItem.dataset.slot = JSON.stringify(timeSlot);
                  slottimeItem.innerHTML = `
                        <span>${timeSlot.FROM} - ${timeSlot.TO}</span>
                        <div class="availability">Available</div>
                    `;
                  slotItemPair.appendChild(slottimeItem);
                  // slottimeItem.addEventListener("click", () => {
                  //   console.log(timeSlot);
                  //   openBookingForm(timeSlot);
                  //   console.log(timeSlot);
                  // });
                  // slottimeItem.addEventListener("click", (event) => {

                  // });
                  console.log(JSON.parse(slottimeItem.dataset.slot));
                  slottimeItem.onclick = function () {
                    console.log("inside the function");

                    const clickedSlotData = JSON.parse(
                      slottimeItem.dataset.slot
                    );
                    openBookingForm(clickedSlotData, slot);
                  };
                }
                slotContainer.appendChild(slotItemPair);
              }
            } else {
              // Display message if no slots available for the current time period
              slotContainer.innerHTML += `<h4><img src="${iconUrls[timePeriod]}" alt="${timePeriod} Icon" style="width: 40px; height: 40px;"> ${timePeriod} Slots</h4>`;
              slotContainer.innerHTML +=
                '<div class="no-slots-animation">No slots available</div>';
            }
          });
        } else {
          // Handle case where slot data is missing or incorrect
          slotContainer.innerHTML = "Error: Slot data not available";
        }
        // Attach event listener to slot time items
        const slotTimeItems = document.querySelectorAll(".modal-slot-item");
        slotTimeItems.forEach((slotTimeItem) => {});
      }

      // // Function to handle click event on modal slot item
      function handleModalSlotClick(slotData) {
        // You can perform actions here when a slot item is clicked
        console.log(slotData);
        // For example, you can make an appointment, etc.
      }

      // Create a function to generate the doctor's profile page
      async function generateDoctorProfilePage(doctorData) {
        // Create container element
        const container = document.createElement("div");
        container.classList.add("container", "mt-5");
        const profileContainer = document.getElementById(
          "doctorProfileContainer"
        );
        // Create profile row
        const profileRow = document.createElement("div");
        profileRow.classList.add("row", "doctor-profile");

        // Create image column
        const imageCol = document.createElement("div");
        imageCol.classList.add("col-md-4", "col-sm-12", "doctor-image");
        const image = document.createElement("img");
        image.src = doctorData.DR_PHOTO;
        image.alt = doctorData.DR_NAME;
        image.classList.add("img-thumbnail");
        imageCol.appendChild(image);

        // Create info column
        const infoCol = document.createElement("div");
        infoCol.classList.add("col-md-8", "col-sm-12", "doctor-info");
        const nameHeader = document.createElement("h2");
        nameHeader.textContent = doctorData.DR_NAME;
        const designationPara = document.createElement("p");
        designationPara.classList.add("designation");
        designationPara.textContent = doctorData.DESIGNATION;
        const specializationDiv = document.createElement("div");
        specializationDiv.classList.add("specialization");
        specializationDiv.innerHTML = `<b>Specialization:</b> ${doctorData.D_CATG}`;
        const experienceDiv = document.createElement("div");
        experienceDiv.classList.add("experience");
        experienceDiv.innerHTML = `<b>Experience:</b> ${doctorData.EXPERIENCE}`;
        const qualificationDiv = document.createElement("div");
        qualificationDiv.classList.add("qualification");
        qualificationDiv.innerHTML = `<b>Qualification:</b> ${doctorData.QUALIFICATION}`;
        const feesDiv = document.createElement("div");
        feesDiv.classList.add("fees");
        feesDiv.innerHTML = `<b>Fees:</b> ${doctorData.DR_FEES}`;
        const idDiv = document.createElement("div");
        idDiv.classList.add("id");
        idDiv.innerHTML = `<b>ID:</b> ${doctorData.DR_ID}`;
        const mobileDiv = document.createElement("div");
        mobileDiv.classList.add("mobile");
        mobileDiv.innerHTML = `<b>Mobile:</b> ${doctorData.DR_MOBILE}`;
        const languageDiv = document.createElement("div");
        languageDiv.classList.add("language");
        languageDiv.innerHTML = `<b>Language:</b> ${doctorData.LANGUAGE}`;
        const sexDiv = document.createElement("div");
        sexDiv.classList.add("sex");
        sexDiv.innerHTML = `<b>Sex:</b> ${doctorData.SEX}`;
        // const appointmentButton = document.createElement("button");
        // appointmentButton.type = "button";
        // appointmentButton.classList.add(
        //   "btn",
        //   "btn-primary",
        //   "book-appointment"
        // );
        // appointmentButton.textContent = "Book Appointment";
        // appointmentButton.dataset.bsToggle = "modal";
        // appointmentButton.dataset.bsTarget = "#appointmentModal";

        // Append elements to info column
        infoCol.appendChild(nameHeader);
        infoCol.appendChild(designationPara);
        infoCol.appendChild(specializationDiv);
        infoCol.appendChild(experienceDiv);
        infoCol.appendChild(qualificationDiv);
        infoCol.appendChild(feesDiv);
        infoCol.appendChild(idDiv);
        infoCol.appendChild(mobileDiv);
        infoCol.appendChild(languageDiv);
        infoCol.appendChild(sexDiv);
        //infoCol.appendChild(appointmentButton);

        // Append columns to profile row
        profileRow.appendChild(imageCol);
        profileRow.appendChild(infoCol);

        // Create slots row (if needed)
        // You can add this part if you want to include available slots information

        // Append rows to container
        container.appendChild(profileRow);
        // Append container to body
        profileContainer.appendChild(container);
        // slotData = await fetchSlotData(doctorData.DR_ID);
        // slotData = slotData.data;
        slotData = doctordata.SCH_DT;
        // Call the function to generate slot items with dates
        generateSlotItems(slotData);
      }
      // Function to parse query string into object
      function queryStringToObject(queryString) {
        const params = new URLSearchParams(queryString);
        const obj = {};

        for (const [key, value] of params) {
          if (key === "SCH_DT") {
            // Parse slotData JSON string into object
            obj[key] = JSON.parse(decodeURIComponent(value));
          } else {
            obj[key] = decodeURIComponent(value);
          }
        }

        return obj;
      }
      // Parse URL parameters to get doctor's data
      const queryString = window.location.search;
      const doctordata = queryStringToObject(queryString);
      generateDoctorProfilePage(doctordata);
      console.log(doctordata);
      function openBookingForm(slotData, slot) {
        slotdetails = slotData;
        slotTiming = slot;
        console.log("Inside Booking form");
        const slotContainer = document.querySelector(".slot-container");
        const bookingContainer = document.querySelector(".booking-container");
        slotContainer.style.display = "none";
        bookingContainer.style.display = "block";
        const bookingForm = document.querySelector(".booking-form");

        bookingForm.style.display = "block"; // Show booking form
      }

      document
        .getElementById("patientMobile")
        .addEventListener("input", function (event) {
          const mobileNumber = event.target.value;
          if (mobileNumber.length === 10 && !isNaN(mobileNumber)) {
            // Call function to handle mobile number with 10 digits
            handleMobileNumberWith10Digits(mobileNumber);
          }
        });

      async function handleMobileNumberWith10Digits(mobile) {
        const url = "http://easyhealths.com/api/srchmob";
        const params = {
          MOBILE: mobile,
        };

        try {
          const response = await axios.post(url, params);
          const patients = response.data.data ? response.data.data : [];

          // Clear any previous dropdown options
          const selectElement = document.getElementById("patientDropdown");
          selectElement.innerHTML = "";
          console.log(patients);
          if (patients.length > 0) {
            // Show the dropdown/select element
            selectElement.style.display = "block";

            // Create default option
            const defaultOption = document.createElement("option");
            defaultOption.value = "";
            defaultOption.text = "Select Patient";
            selectElement.appendChild(defaultOption);

            // Populate dropdown options with patient data
            patients.forEach((patient) => {
              const option = document.createElement("option");
              option.value = patient.ID; // Store patient ID as option value

              // Store other patient details as data attributes
              option.dataset.name = patient.NAME;
              option.dataset.age = patient.AGE;
              option.dataset.sex = patient.SEX;
              option.dataset.familyId = patient.FAMILY_ID;
              // Set text content for the option
              option.textContent = `${patient.NAME} - Age: ${patient.AGE}, Sex: ${patient.SEX}`;

              selectElement.appendChild(option);
            });
          } else {
            // Hide the dropdown/select element if no data is available
            selectElement.style.display = "none";
            // Make name and age fields editable
            const patientNameInput = document.getElementById("patientName");
            const patientAgeInput = document.getElementById("patientAge");

            patientNameInput.removeAttribute("readonly");
            patientAgeInput.removeAttribute("readonly");
          }
        } catch (error) {
          console.error("Error fetching patient data:", error);
        }
      }
      // Function to check if a string contains only alphabets
      function isValidName(name) {
        return /^[a-zA-Z]+$/.test(name);
      }

      // Function to check if a mobile number is valid (exactly 10 digits)
      function isValidMobile(mobile) {
        return /^\d{10}$/.test(mobile);
      }

      // Function to check if age is not negative
      function isValidAge(age) {
        return age >= 0;
      }

      // Function to display error message
      function displayError(inputField, message) {
        const parentElement = inputField.parentElement;
        const errorElement = parentElement.querySelector(".error-message");

        // Create error message element if not already present
        if (!errorElement) {
          const errorMessage = document.createElement("div");
          errorMessage.classList.add("error-message");
          parentElement.appendChild(errorMessage);
          errorElement = errorMessage;
        }

        // Display error message
        errorElement.textContent = message;
      }

      // Function to clear error message
      function clearError(inputField) {
        const parentElement = inputField.parentElement;
        const errorElement = parentElement.querySelector(".error-message");

        // Clear error message
        if (errorElement) {
          parentElement.removeChild(errorElement);
        }
      }

      // Add event listeners to input fields for validation
      document
        .getElementById("patientName")
        .addEventListener("input", function (event) {
          const name = event.target.value;
          if (!isValidName(name)) {
            displayError(event.target, "Name should only contain alphabets.");
          } else {
            clearError(event.target);
          }
        });

      document
        .getElementById("patientMobile")
        .addEventListener("input", function (event) {
          const mobile = event.target.value;
          if (!isValidMobile(mobile)) {
            displayError(
              event.target,
              "Mobile number should be exactly 10 digits."
            );
          } else {
            clearError(event.target);
          }
        });

      document
        .getElementById("patientAge")
        .addEventListener("input", function (event) {
          const age = parseInt(event.target.value);
          if (!isValidAge(age)) {
            displayError(event.target, "Age cannot be negative.");
          } else {
            clearError(event.target);
          }
        });

      // Modify form submission event listener to include validation
      document
        .getElementById("appointmentForm")
        .addEventListener("submit", async function (event) {
          event.preventDefault(); // Prevent default form submission

          const patientName = document.getElementById("patientName").value;
          const patientMobile = document.getElementById("patientMobile").value;
          const patientGender = document.getElementById("patientGender").value;
          const patientAge = parseInt(
            document.getElementById("patientAge").value
          );
          const patientDropdown = document.getElementById("patientDropdown");
          const selectedOption =
            patientDropdown.options[patientDropdown.selectedIndex];

          // Retrieve data from dataset attributes of the selected option
          const patientId = selectedOption.value; // This would be the entire patient object as a JSON string
          const patientNameFromDataset = selectedOption.dataset.name;
          const patientAgeFromDataset = selectedOption.dataset.age;
          const patientSexFromDataset = selectedOption.dataset.sex;
          const patientFamilyIdFromDataset = selectedOption.dataset.familyId;
          // Perform validation before submitting the form
          let isValid = true;

          if (!isValidName(patientName)) {
            displayError(
              document.getElementById("patientName"),
              "Name should only contain alphabets."
            );
            isValid = false;
          } else {
            clearError(document.getElementById("patientName"));
          }

          if (!isValidMobile(patientMobile)) {
            displayError(
              document.getElementById("patientMobile"),
              "Mobile number should be exactly 10 digits."
            );
            isValid = false;
          } else {
            clearError(document.getElementById("patientMobile"));
          }

          if (!isValidAge(patientAge)) {
            displayError(
              document.getElementById("patientAge"),
              "Age cannot be negative."
            );
            isValid = false;
          } else {
            clearError(document.getElementById("patientAge"));
          }

          // If all fields are valid, submit the form
          if (isValid) {
            // Make an API call to book appointment
            // You can add your API endpoint here

            const patientDetails = {
              FAMILY_ID: patientFamilyIdFromDataset,
              PATIENT_ID: patientId,
              MOBILE: patientMobile,
              DR_ID: doctordata.DR_ID,
              DR_NAME: doctordata.DR_NAME,
              APNT_DT: slotTiming.SCH_DT,
              PHARMA_ID: userData.PHARMA_ID,
              PHARMA_NAME: userData.PHARMA_NAME,
              APNT_ID: slotTiming.ID,
              FROM: slotdetails.FROM,
              TO: slotdetails.TO,
              DR_FEES: doctordata.DR_FEES,
            };
            console.log(patientDetails);
            // Reset form fields
            this.reset();

            // Hide booking form after submission
            document.querySelector(".booking-form").style.display = "none";
            document.querySelector(".slot-container").style.display = "block";
          }
        });

      // Add event listener to the patient dropdown
      const patientDropdown = document.getElementById("patientDropdown");
      patientDropdown.addEventListener("change", function () {
        // Get the selected option from the dropdown
        const selectedOption = this.options[this.selectedIndex];

        // Populate input fields with selected patient data
        const patientNameInput = document.getElementById("patientName");
        const patientAgeInput = document.getElementById("patientAge");
        const patientGenderInput = document.getElementById("patientGender");

        patientNameInput.value = selectedOption.dataset.name; // Populate name input field
        patientAgeInput.value = selectedOption.dataset.age; // Populate age input field
        patientGenderInput.value = selectedOption.dataset.sex; // Populate gender input field

        // Make input fields non-editable
        patientNameInput.setAttribute("readonly", true);
        patientAgeInput.setAttribute("readonly", true);
        patientGenderInput.setAttribute("readonly", true);
      });
    </script>
  </body>
</html>
